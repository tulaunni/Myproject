public without sharing class BLN_Order_DAO{
 /**
* @author :Arindam Sarkar
* @date 05/12/2014
* @ This class is used for DML operations on Order object
*/   
 
  //Query tkt profile
  public Order__c getTktProfile(String ordId){
    return [select id,BLN_TKT_profile__c from Order__c where id=:ordId];
  } 

   //Insering Order  
   public BLN_StatusMessage insertOrder(Order__c  ord){
       dataBase.saveResult saveRes = dataBase.insert(ord,false); 
       return new BLN_StatusMessage(saveRes);
    }
    
 
      //updating Order  
   public BLN_StatusMessage updateOrder(Order__c  ord){
       dataBase.saveResult saveRes = dataBase.update(ord,false); 
       system.debug('RRRRRRRRRRRR '+saveRes);
       return new BLN_StatusMessage(saveRes);
    }
    
   
   //get values form ids of order
   public List<order__c> orderQuery(string str){
   string st = 'Select (Select Order_Item__r.Each_Ticket_Price__c,Order__r.Order_Taxes__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.bln_gn_user__c,tkt_profile__r.tkt_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c, Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,TKT_profile__r.lastmodifiedDate,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,item_pool__r.addon_parent__r.id, Parent_ID__c,Item_Pool__r.Item_Type__r.Name, Order_Item__r.Item_Fee__c, Order_Item__r.Item_Discount__c, Order_Item__r.Item_Quantity__c,Item_Pool__r.Item_Pool_Name__c,order_item__r.tax__c from Tickets__r),(Select Item__r.Event__r.End_Date__c,Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.BLN_TKT_profile__r.BLN_GN_User__c, order__r.BLN_TKT_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Fee__c,Tax__c,item__r.item_type__r.Name,lastmodifieddate,Order__r.Events__r.BLN_Country__r.Currency__r.Currency_Symbol__c,Item__r.Item_Pool__c  From Order_Items__r ), (select id,name,BLN_Pay_Gateway__c,BLN_Pay_Gateway__r.PGateway_Type__r.Name,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,BLN_Pay_Gateway__r.PGateway_Type__r.Adaptive_Type__c,credit_card_type__c from Payments__r),EVent_Admin_Comments__c,createdDate,Events__r.Time_Zone__c,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c, o.Fee_Amount__c, o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.BLN_TKT_profile__r.BLN_Company__c, BLN_TKT_profile__r.Mobile__c,o.Amount_Paid__c,BLN_TKT_profile__r.Email__c,BLN_TKT_profile__r.BLN_GN_User__r.User__r.id,BLN_TKT_profile__r.BLN_GN_User__r.user__r.userName, BLN_TKT_profile__r.TKT_Company__c,BLN_TKT_profile__r.First_Name__c,BLN_TKT_profile__r.Last_Name__c,BLN_TKT_profile__r.Blogger__c,BLN_TKT_profile__r.Blog_URL__c From Order__c o ' + str;
    system.debug(st+'@@queryorder');
    system.debug(st.length() + '@@queryorder');
    return DataBAse.query(st);
   } 
   
   public List<order__c> orderQuery1(SET<id> ordIds){
       
    return [Select (SELECT id,tkt_profile__r.tkt_company__c,tkt_profile__r.lastmodifiedDate,tkt_profile__r.bln_company__c from Tickets__r),EVent_Admin_Comments__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c, o.Fee_Amount__c, o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.bln_tkt_profile__r.bln_company__c, bln_tkt_profile__r.Mobile__c,o.Amount_Paid__c,bln_tkt_profile__r.BLN_gn_user__r.User__r.userName,bln_tkt_profile__r.bln_gn_user__r.User__r.id,bln_tkt_profile__r.lastmodifiedDate,bln_tkt_profile__r.bln_gn_user__r.User__r.MobilePhone,bln_tkt_profile__r.Email__c,bln_tkt_profile__r.BLN_Company__r.Name,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Last_Name__c,BLN_TKT_profile__r.Blogger__c,BLN_TKT_profile__r.Blog_URL__c From Order__c o where Id IN :ordIds order by id];
   
   } 
   
    
    //get values form ids of order
   public List<order__c> orderQuery(SET<ID> idval){
    return  [Select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,bln_tkt_profile__r.Mobile__c, o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c,  o.bln_tkt_profile__r.TKT_Company__c, o.Amount_Paid__c,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.bln_company__r.Name,bln_tkt_profile__r.Email__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.lastmodifiedDate,bln_tkt_profile__r.Blogger__c,bln_tkt_profile__r.Blog_URL__c From Order__c o where id IN :idval and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )];
    
   } 
   
   
   
   //Getting child records of order 
   public List<order__c> orderQueryBadgableChildTicket(SET<id> orderIds){
     return [select BLN_TKT_profile__r.Blogger__c,BLN_TKT_profile__r.Blog_URL__c,Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c,  o.bln_tkt_profile__r.bln_company__c, o.Amount_Paid__c,(Select Order_Item__r.Each_Ticket_Price__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.tkt_company__c,tkt_profile__r.lastmodifiedDate,tkt_profile__r.bln_company__r.Name,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,badgeparentid__r.Badge_ID__c,Badge_ID__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,Item__r.item_type__r.Name,item__r.Item_Pool__r.Item_Pool_Name__c,Item_Pool__r.Item_Pool_Name__c,Parent_ID__c,Item_Pool__r.Item_Type__r.Name,tkt_profile__r.bln_company__c,tkt_profile__r.mobile__c,Tag_No__c,Note__c,Item_Type__r.Badgable__c from Tickets__r where Order_Item__r.Status__c!='Cancelled' and Item_Type__r.Badgable__c !='N - No Badge'  order by Name),bln_tkt_profile__r.Mobile__c,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.tkt_company__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.lastmodifiedDate,
bln_tkt_profile__r.Email__c,bln_tkt_profile__r.id, bln_tkt_profile__r.Last_Name__c From Order__c o where id IN :orderIds and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )];
   }
   
   //Getting child records of order 
   public List<order__c> orderQueryChild(string str,string eveId){
    if(eveId=='All'){
        return [select Events__r.Accept_Refund_Policy__c,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,createdDate,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c,  o.bln_tkt_profile__r.tkt_company__c, o.Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__r.Email__c,order__r.bln_tkt_profile__r.bln_gn_user__r.user__c, Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item__r.Item_Pool__r.Item_Pool_Name__c,Item__r.item_type__r.Name,Item_Fee__c,Tax__c  From Order_Items__r ),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Mobile__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.Email__c From Order__c o where bln_tkt_profile__r.bln_gn_user__r.user__c  = :str and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )];
    }else{
        return [select Events__r.Accept_Refund_Policy__c,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,createdDate,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c,  o.bln_tkt_profile__r.tkt_company__c, o.Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__r.Email__c,order__r.bln_tkt_profile__r.bln_gn_user__r.user__c, Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item__r.Item_Pool__r.Item_Pool_Name__c,Item__r.item_type__r.Name,Item_Fee__c,Tax__c  From Order_Items__r where Item__r.Event__c=:eveId),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Mobile__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.Email__c From Order__c o where bln_tkt_profile__r.bln_gn_user__r.user__c  = :str and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )];
    }
     
   }  
   
    //Getting child records of order 
    public List<order__c> orderQueryChildOrditem(SET<id> orderIds){
     return [select Events__r.Street1__c,Events__r.Street2__c,Events__r.City__c,Events__r.BLN_State__r.Short_Name__c,Events__r.ZipCode__c,(select id,name,Payment_Mode__c,credit_card_last_4digits__c from Payments__r),Events__r.Logo_URL__c,Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Time_Zone__c,Events__r.BLN_Country__r.Currency__r.Currency_Symbol__c,Events__r.Name,Events__r.Start_Date__c, Events__r.Venue_Name__c,Events__r.End_Date__c, Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.BLN_TKT_profile__r.BLN_GN_User__c, o.BLN_TKT_profile__r.TKT_Company__c, o.Amount_Paid__c,(Select Item__r.Event__r.End_Date__c,Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.BLN_TKT_profile__r.BLN_GN_User__c, order__r.BLN_TKT_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,/*Item__r.Event__r.End_Date__c,*/item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Fee__c,Tax__c,item__r.item_type__r.Name,lastmodifieddate,Order__r.Events__r.BLN_Country__r.Currency__r.Currency_Symbol__c,Item__r.Name  From Order_Items__r ),BLN_TKT_profile__r.BLN_Company__c,BLN_TKT_profile__r.Mobile__c,BLN_TKT_profile__r.Last_Name__c,BLN_TKT_profile__r.First_Name__c,BLN_TKT_profile__r.Email__c,bln_tkt_profile__r.Blogger__c,bln_tkt_profile__r.Blog_URL__c,EVent_Admin_Comments__c,owner.userName,lastmodifieddate,BLN_TKT_profile__r.BLN_GN_User__r.user__r.userName,BLN_TKT_profile__r.TKT_Job_Title__c,BLN_TKT_profile__r.lastmodifiedDate,BLN_TKT_profile__r.User_Pic__c,BLN_TKT_profile__r.FaceBookId__c,BLN_TKT_profile__r.LinkedInId__c,BLN_TKT_profile__r.TwitterId__c,BLN_TKT_profile__r.Biography__c,BLN_TKT_profile__r.Company_Description__c,BLN_TKT_profile__r.Company_Logo__c,BLN_TKT_profile__r.Company_Website_URL__c  From Order__c o where Id In :orderIds];// and (Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )  
 }
    
    //Getting child records of order    
   public List<order__c> orderQueryChildTicket(SET<id> orderIds){
     return [select bln_tkt_profile__r.Blogger__c,bln_tkt_profile__r.Blog_URL__c,Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c,  o.bln_tkt_profile__r.TKT_Company__c, o.Amount_Paid__c,
 (Select Item_Pool__r.Ticket_Settings__c,Item_Pool__r.Name , Order_Item__r.Name,Item__r.Name,Ticket_Display_Order__c,order__r.id,item_type__r.Badgable__c,Tkt_profile__r.BLN_GN_User__c,Tkt_profile__r.Home_Address__r.Address1__c,Tkt_profile__r.Home_Address__r.Address2__c,Tkt_profile__r.Home_Address__r.City__c,Tkt_profile__r.Home_Address__r.State__c,Tkt_profile__r.Home_Address__r.State__r.name,Tkt_profile__r.Home_Address__r.Country__c,Tkt_profile__r.Home_Address__r.Country__r.name,Tkt_profile__r.lastmodifiedDate,Tkt_profile__r.Home_Address__r.PoBox__c,Tkt_profile__r.Home_Address__r.ZipCode__c,Tkt_profile__r.Work_Address__r.Address1__c,Tkt_profile__r.Work_Address__r.Address2__c,Tkt_profile__r.Work_Address__r.City__c,Tkt_profile__r.Work_Address__r.State__c,Tkt_profile__r.Work_Address__r.State__r.name,Tkt_profile__r.Work_Address__r.Country__c,Tkt_profile__r.Work_Address__r.Country__r.name,Tkt_profile__r.Work_Address__r.PoBox__c,Tkt_profile__r.Work_Address__r.ZipCode__c,Tkt_profile__r.Billing_Address__r.Address1__c,Tkt_profile__r.Billing_Address__r.Address2__c,Tkt_profile__r.Billing_Address__r.City__c,Tkt_profile__r.Billing_Address__r.State__c,Tkt_profile__r.Billing_Address__r.State__r.name,Tkt_profile__r.Billing_Address__r.Country__c,Tkt_profile__r.Billing_Address__r.Country__r.name,Tkt_profile__r.Billing_Address__r.PoBox__c,Tkt_profile__r.Billing_Address__r.ZipCode__c,Tkt_profile__r.Shipping_Address__r.Address1__c,Tkt_profile__r.Shipping_Address__r.Address2__c,Tkt_profile__r.Shipping_Address__r.City__c,Tkt_profile__r.Shipping_Address__r.State__c,Tkt_profile__r.Shipping_Address__r.State__r.name,Tkt_profile__r.Shipping_Address__r.Country__c,Tkt_profile__r.Shipping_Address__r.Country__r.name,Tkt_profile__r.Shipping_Address__r.PoBox__c,Tkt_profile__r.Shipping_Address__r.ZipCode__c,Tkt_profile__r.Mobile__c,Order_Item__r.Each_Ticket_Price__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,TKT_profile__r.BLN_Company__c,TKT_profile__r.tkt_Company__c,TKT_profile__r.Company_Logo__c,TKT_profile__r.Video__c,TKT_profile__r.User_Pic__c,TKT_profile__r.Work_Phone__c,TKT_profile__r.TwitterId__c,TKT_profile__r.Suffix__c,TKT_profile__r.Prefix__c,TKT_profile__r.LinkedInId__c,TKT_profile__r.Home_Phone__c,TKT_profile__r.Gender__c,TKT_profile__r.FourSquareId__c,TKT_profile__r.DOB__c,TKT_profile__r.FaceBookId__c,TKT_profile__r.Age__c,TKT_profile__r.Blogger__c,TKT_profile__r.Biography__c,TKT_profile__r.email__c,TKT_profile__r.First_Name__c,TKT_profile__r.Last_Name__c,Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,badgeparentid__r.Badge_ID__c,Badge_ID__c,NAme,Item_Type__r.Name,lastmodifiedDate,Item__r.item_type__r.Name,item__r.Item_Pool__r.Item_Pool_Name__c,Item_Pool__r.Item_Pool_Name__c,Parent_ID__c,Item_Pool__r.Item_Type__r.Name,TKT_profile__r.TKT_Job_Title__c ,Tag_No__c,Note__c,Item_Pool__r.Badgable__c,Event__r.BLN_Country__r.Currency__r.Currency_Symbol__c,Custom_Barcode__c,Scan_Id__c,TKT_profile__r.Company_Description__c,TKT_profile__r.Company_Website_URL__c ,TKT_profile__r.Blog_URL__c from Tickets__r where Order_Item__r.Status__c!='Cancelled' order by Name),
  BLN_TKT_profile__r.Mobile__c,BLN_TKT_profile__r.TKT_Job_Title__c,BLN_TKT_profile__r.User_Pic__c,BLN_TKT_profile__r.FaceBookId__c,BLN_TKT_profile__r.LinkedInId__c,BLN_TKT_profile__r.TwitterId__c,BLN_TKT_profile__r.Biography__c,BLN_TKT_profile__r.Company_Description__c,BLN_TKT_profile__r.Company_Logo__c,BLN_TKT_profile__r.Company_Website_URL__c From Order__c o where id IN :orderIds order by Id]; //and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )
   }
    
   // Getting all values for order and its line items By Phani    
    public List<order__c> order(SET<id> orderIds){
        return [select bln_tkt_profile__r.Mobile__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c,o.EVent_Admin_Comments__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.bln_tkt_profile__c, o.bln_tkt_profile__r.tkt_company__c,o.owner.id, o.Amount_Paid__c,(Select Each_Ticket_Price__c,Promotion__c,item__r.event__r.Name ,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Type__r.BL_Fee_Amt_per_res__c,Item_Fee__c,Tax__c  From Order_Items__r ),(Select Order_Item__r.Each_Ticket_Price__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,Event__c,tkt_profile__r.Mobile__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,Parent_ID__c,Item_Pool__r.Item_Type__r.Name,tkt_profile__r.tkt_company__c,item__r.Item_Type__r.Name,Item_Pool__r.Item_Pool_Name__c   from Tickets__r),(select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Email__c,BLN_TKT_profile__r.TKT_Job_Title__c,BLN_TKT_profile__r.User_Pic__c,BLN_TKT_profile__r.FaceBookId__c,BLN_TKT_profile__r.LinkedInId__c,BLN_TKT_profile__r.TwitterId__c,BLN_TKT_profile__r.Biography__c,BLN_TKT_profile__r.Company_Description__c,BLN_TKT_profile__r.Company_Logo__c,BLN_TKT_profile__r.Company_Website_URL__c From Order__c o where Id In :orderIds and (Order_Status__c != 'Cancelled' AND Order_Status__c != 'Abandoned' AND Order_Status__c != 'Not Paid' )];
    }
    
    // Getting Orders List based on Event written by Manasa Gandham
     public List<order__c> orderListForEvent(String str){
     system.debug('str=============='+str);
        LIST<order__c> ordersList= new LIST<order__c>();

        string queryString= 'select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.bln_tkt_profile__c, o.bln_tkt_profile__r.tkt_company__c, o.Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Fee__c,Tax__c From Order_Items__r ), (Select Order_Item__r.Each_Ticket_Price__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.tkt_company__c,tkt_profile__r.Bln_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c,Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate, Parent_ID__c,Item_Pool__r.Item_Type__r.Name,Item__c,Tkt_profile__r.First_Name__c from Tickets__r), (select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,BLN_Pay_Gateway__r.PGateway_Type__r.Name,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,BLN_Pay_Gateway__r.PGateway_Type__r.Adaptive_Type__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Email__c From Order__c o'+ str;
                            
       system.debug('   QUERY STRING '+queryString);
        ordersList= dataBase.query(queryString);
         system.debug('   QUERY LIST '+ordersList.size());
        return ordersList;
    }
    
    //..................................
    public List<order__c> orderListForEvent(String EventId,Datetime FromDate, Datetime ToDate){
    system.debug('EventId==='+EventId);
     system.debug('FromDate==='+FromDate);
     system.debug('ToDate=============='+ToDate);
        LIST<order__c> ordersList= new LIST<order__c>();

     ordersList  =[select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c,o.Fee_Amount__c,o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.bln_tkt_profile__c, o.bln_tkt_profile__r.tkt_company__c, o.Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Fee__c,Tax__c From Order_Items__r ), (Select Order_Item__r.Each_Ticket_Price__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.tkt_company__c,tkt_profile__r.Bln_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c,Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate, Parent_ID__c,Item_Pool__r.Item_Type__r.Name,Item__c,Tkt_profile__r.First_Name__c from Tickets__r), (select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,BLN_Pay_Gateway__r.PGateway_Type__r.Name,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,BLN_Pay_Gateway__r.PGateway_Type__r.Adaptive_Type__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,bln_tkt_profile__r.Email__c From Order__c o WHERE Order_Status__c !='Cancelled' AND Order_Status__c !='Abandoned' AND Order_Status__c !='Not Paid' AND CreatedDate>=:FromDate AND CreatedDate <=:ToDate AND Events__c=:EventId];
        system.debug('   QUERY STRING '+ordersList);
        
        return ordersList;
    }
    
    //......................................
    public List<order__c> orderListForEventSearch(String EventId, DateTime FromDate, DateTime ToDate, String SearchString, SET<Id> OrderIds, String selectedOrderType){
    LIST<order__c> ordersList= new LIST<order__c>();
    system.debug(FromDate+'   FROM DATE IN ORDERS  '+ToDate+'   '+OrderIds);
    if(selectedOrderType == 'All'){
        ordersList= [select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c, Fee_Amount__c, Order_Total__c, Order_Taxes__c, Order_Sub_Total__c, Order_Status__c, Order_Discount__c, Name, Id, Currency_Code__c, bln_tkt_profile__r.bln_gn_user__c, bln_tkt_profile__r.tkt_company__c, Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__r.bln_gn_user__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c  From Order_Items__r ),(Select Order_Item__r.Each_Ticket_Price__c,Order__r.Order_Taxes__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.bln_gn_user__c,tkt_profile__r.tkt_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c, Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,item_pool__r.addon_parent__r.id, Parent_ID__c,Item_Pool__r.Item_Type__r.Name, Order_Item__r.Item_Fee__c, Order_Item__r.Item_Discount__c, Order_Item__r.Item_Quantity__c,Item_Pool__r.Item_Pool_Name__c,order_item__r.tax__c from Tickets__r Where ((Item_Type__r.Name = 'Package' AND Parent_ID__c !=null) OR (Item_Type__r.Name != 'Package')) and  ticket_status__c!=null order by Name asc),(select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Name,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,BLN_TKT_profile__r.Email__c 
                     From Order__c
                     WHERE Events__c =: EventId
                     //AND  Order_Status__c =: 'Cancelled'
                     AND Id IN : OrderIds];
                       
    }else if(selectedOrderType == 'Successed'){
        ordersList= [select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c, Fee_Amount__c, Order_Total__c, Order_Taxes__c, Order_Sub_Total__c, Order_Status__c, Order_Discount__c, Name, Id, Currency_Code__c, bln_tkt_profile__r.bln_gn_user__c, bln_tkt_profile__r.tkt_company__c, Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__r.bln_gn_user__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c  From Order_Items__r ),(Select Order_Item__r.Each_Ticket_Price__c,Order__r.Order_Taxes__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.bln_gn_user__c,tkt_profile__r.tkt_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c, Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,item_pool__r.addon_parent__r.id, Parent_ID__c,Item_Pool__r.Item_Type__r.Name, Order_Item__r.Item_Fee__c, Order_Item__r.Item_Discount__c, Order_Item__r.Item_Quantity__c,Item_Pool__r.Item_Pool_Name__c,order_item__r.tax__c from Tickets__r Where ((Item_Type__r.Name = 'Package' AND Parent_ID__c !=null) OR (Item_Type__r.Name != 'Package')) and  ticket_status__c!=null order by Name asc),(select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Name,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,BLN_TKT_profile__r.Email__c 
                    From Order__c
                     WHERE Events__c =: EventId
                    // AND Transaction_Status__c =: 'Completed' 
                     AND Order_Status__c !=: 'Cancelled'
                     AND Order_Status__c !=: 'Abandoned'
                     AND Order_Status__c !=: 'Not Paid'
                     AND Id IN : OrderIds];
    }else if(selectedOrderType == 'Cancelled'){
        ordersList= [select Events__r.Accept_Refund_Policy__c,createdDate,Events__r.Name,Events__r.Start_Date__c,Events__r.Venue_Name__c,Events__r.End_Date__c,Events__c, Fee_Amount__c, Order_Total__c, Order_Taxes__c, Order_Sub_Total__c, Order_Status__c, Order_Discount__c, Name, Id, Currency_Code__c, bln_tkt_profile__r.bln_gn_user__c, bln_tkt_profile__r.tkt_company__c, Amount_Paid__c,(Select Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.bln_tkt_profile__r.bln_gn_user__c, order__r.bln_tkt_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,Item__r.Event__r.End_Date__c,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c  From Order_Items__r ),(Select Order_Item__r.Each_Ticket_Price__c,Order__r.Order_Taxes__c,Item_Pool__c,Item_Type__c,item__r.item_name__c,id,tkt_profile__r.bln_gn_user__c,tkt_profile__r.tkt_company__c,tkt_profile__r.Email__c,tkt_profile__r.bln_gn_user__r.user__c,tkt_profile__r.bln_gn_user__r.user__r.userName,tkt_profile__r.bln_gn_user__r.user__r.email,tkt_profile__r.First_Name__c,tkt_profile__r.Last_Name__c,tkt_profile__r.Mobile__c, Event__c,Order__c,Order_Item__c,Ticket_Status__c,Tstatus_Id__r.Tstatus_name__c,Badge_Label__c,NAme,Item_Type__r.Name,tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,lastmodifiedDate,item_pool__r.addon_parent__r.id, Parent_ID__c,Item_Pool__r.Item_Type__r.Name, Order_Item__r.Item_Fee__c, Order_Item__r.Item_Discount__c, Order_Item__r.Item_Quantity__c,Item_Pool__r.Item_Pool_Name__c,order_item__r.tax__c from Tickets__r Where ((Item_Type__r.Name = 'Package' AND Parent_ID__c !=null) OR (Item_Type__r.Name != 'Package')) and  ticket_status__c!=null order by Name asc),(select Currency_Code__c,Pay_Address__c,BLN_Pay_Gateway__c,Payment_Ref_Number__c,Payment_Mode__c,Registration_Type__c,Payment_Amount__c,credit_card_type__c from Payments__r),bln_tkt_profile__r.bln_gn_user__r.user__r.Name,bln_tkt_profile__r.bln_gn_user__r.user__r.userName,bln_tkt_profile__r.bln_gn_user__r.user__r.MobilePhone,bln_tkt_profile__r.Name,bln_tkt_profile__r.Last_Name__c,bln_tkt_profile__r.First_Name__c,BLN_TKT_profile__r.Email__c 
                     From Order__c
                     WHERE Events__c =: EventId
                     AND Order_Status__c =: 'Cancelled' 
                 AND Id IN : OrderIds];
    }
   return ordersList;
    }
    
    
      public List<order__c> ExorderQuery(List<String> expids){
    List<Order__c>   ExordersList = [Select (Select Item__r.Event__r.End_Date__c,Each_Ticket_Price__c,item__r.event__r.Name ,Promotion__c,Promotion__r.Name, Order__c, Name, Item__c, Item_Total__c,order__r.BLN_TKT_profile__r.BLN_GN_User__c, order__r.BLN_TKT_profile__r.Email__c,Item_Quantity__c, Item_Price__c, Item_Discount__c, Id,item__r.item_name__c,Status__c,Promotion__r.Promo_Code__c,Currency__c,Item_Fee__c,Tax__c,item__r.item_type__r.Name,lastmodifieddate,Order__r.Events__r.BLN_Country__r.Currency__r.Currency_Symbol__c  From Order_Items__r ),(select id, name, Payment_Mode__c,Registration_Type__c from Payments__r), EVent_Admin_Comments__c, createdDate, Events__r.Time_Zone__c, Events__r.Name, Events__r.Start_Date__c, Events__r.Venue_Name__c, Events__r.End_Date__c, Events__c, o.Fee_Amount__c, o.Order_Total__c, o.Order_Taxes__c, o.Order_Sub_Total__c, o.Order_Status__c, o.Order_Discount__c, o.Name, o.Id, o.Currency_Code__c, o.BLN_TKT_profile__r.BLN_Company__c, BLN_TKT_profile__r.Mobile__c, o.Amount_Paid__c, BLN_TKT_profile__r.Email__c, BLN_TKT_profile__r.BLN_GN_User__r.User__r.id, BLN_TKT_profile__r.BLN_GN_User__r.user__r.userName, BLN_TKT_profile__r.TKT_Company__c, BLN_TKT_profile__r.First_Name__c, BLN_TKT_profile__r.Last_Name__c From Order__c o where Id IN :expids];
  
    return ExordersList;
   } 
    
}