<apex:page standardController="BLN_Event__c" extensions="BLN_ReUse_EventsEditCon" showHeader="false"  standardStylesheets="false" >
<c:AjaxLoader LoaderImage="{!$Resource.AjaxLoaderImage}"/>
<!------------------------------------
Page reusability:
This Page contains all the codes related to popupmanage ticket/package,popup tags,render ticket/package,
scripts for loading of tickets,save tickets and Ticket Validations

Used in Modules:BLN_TicketsNew(Manage Tickets),BLN_EventNew(Create&edit event).



--------------------->
 
 <!---------------------------------------popup for managetags------------------------------------------------------>        
     <div id="dialogoverlay"></div>
<!--close of dialogoverlay-->
<div id="dialogbox"><a  id="close" onclick="AlertMT.Cancel()" style="color: white;">×</a>
<div class="grid-1" style=" width:98%;margin-left:1%; padding-right:0px;">
    <div class="title-grid">Manage Tag</div>
    <div class="content-gird" >
    
    <!--<button id="btnAdicionar">Novo</button>-->
        <table id="managetagpopup" style="width:100%;">         
            <thead>
                <tr style="background-color:#BCBCBC; ">
                    <td colspan="3" style="color:#ffffff;">Edit or Delete your Tags</td>
                    
                </tr>
            </thead>
            <tbody>
                
                <tr>
                    <td width="85%">Attendee</td>
                
                    <td><img src=" {!URLFOR($Resource.createevents,'createevents/images/delete1.png')}" class="btnExcluir" style="margin-right:20%;"/><img src="{!URLFOR($Resource.createevents,'createevents/images/pencil.png')}" width="20" height="20" class="btnEditar"/></td>
                </tr>
               
                <tr>
                    <td width="85%">Exhibitor</td>
                    
                    <td><img src="{!URLFOR($Resource.createevents,'createevents/images/delete1.png')}" class="btnExcluir" style="margin-right:20%"/><img src="{!URLFOR($Resource.createevents,'createevents/images/pencil.png')}" width="20" height="20" class="btnEditar"/></td>
                </tr>
                
                 <tr>
                    <td width="85%">Sponsor</td>
                    
                    <td><img src="{!URLFOR($Resource.createevents,'createevents/images/delete1.png')}" class="btnExcluir" style="margin-right:20%"/><img src="{!URLFOR($Resource.createevents,'createevents/images/pencil.png')}" width="20" height="20" class="btnEditar"/></td>
                </tr>
            
            </tbody>
        </table>
    
    
    </div><!--close of content-grid-->
    </div><!--close of grid1-->
</div>  <!--close of dialogbox-->



<!-------------------------------------------------->    
<!------------------------------ticket more --info content popup------------->
        <div id="dialogoverlay2"></div>
          <div id="dialogbox3">
          <a  id="close" onclick="Alert3.Cancel()"  style="color: white;">×</a>
        
              <div class="grid-1" style="text-align:left;"  >
             
                <div class="title-grid">More Information</div>
                <div class="content-gird" style="">
     

                
                  <div class="form" style="font-size:13px;">
                    <div id="left-form" style=" width:49%; padding-bottom:20px; margin-top:15px;  border:0px #000000 solid; float:left">
                   
                    
                   
                      <div class="elem">
                        <label>Ticket Name: </label>
                        <label id="mandatory">*</label>
                        <div class="indent">
                          <input type="text"  id="tminfoname" name="tminfoname" class="medium" disabled="disabled"/>
                        </div>
                      </div>
                       <div class="elem">
                        <label>
                        
                         Type: </label>
                        <label id="mandatory">*</label>
                        <div class="indent">
                        <apex:repeat value="{!paymentSelectOptions}" var="paytype">
                        <input type="radio"  style="outline:none;" checked="checked" onchange="validfreetick()"   name="payradio" value="{!paytype.value}"/><span style="margin-left:5px; ">{!paytype.label}</span><br/>
                        </apex:repeat>
                        <script>
                        Visualforce.remoting.timeout = 120000; // Set timeout at page level
                        function validfreetick()
                        {
                            var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
        if(document.querySelector('input[name="payradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
       row.cells[6].children[0].disabled=false;
       }
       }
       if($("#itemtype").find("option:selected").text()=='Seminars'&&document.querySelector('input[name="payradio"]:checked').value=='Free'){
             document.getElementById('ticketedsessiondiv').style.display='';
              $('input[name="ticketedsession"][value="true"]').attr("checked",true);
             }
             else
             document.getElementById('ticketedsessiondiv').style.display='none';
                        }
                        </script>

                        </div>
                      </div>
                      
                        <div class="elem">
                        <label>Ticket Type:</label>
                        <div class="indent">
                         <apex:outputpanel id="itemtypeblock">
                         <select id="itemtype" style="width:76%" class="selectlist" onchange="editticketbadgelabel(this.value)">
                           <optgroup label="Tickets">
                            <apex:repeat value="{!individualTicketsSelectOptions}" var="indittype">
                            <option value="{!indittype.value}">{!indittype.label}</option>
                            </apex:repeat> 
                            </optgroup>
                             <optgroup label="Eventdex Products">

                            <apex:repeat value="{!BLPRODTicketsSelectOptions}" var="indittype">
                            <option value="{!indittype.value}">{!indittype.label}</option>
                            </apex:repeat>
                            </optgroup>                         
                          </select>
                          </apex:outputpanel>
                        </div>
                      </div>
                      
                      <script>
                          function editticketbadgelabel(titemtype)
                         {
                            
                            
                            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            titemtype,
            1,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                                document.getElementById('tbdglabel').value="";
                                document.getElementById('tbdgable').checked=false;
                                document.getElementById('tbdglabel').disabled="disabled";
                             }
                           else{
                             document.getElementById('tbdglabel').disabled=false; 
                             document.getElementById('tbdgable').checked=true;
                             document.getElementById('tbdglabel').value=result.badgelabel;
                         }
             });
             
             if($("#itemtype").find("option:selected").text()=='Speaker'||$("#itemtype").find("option:selected").text()=='Scan Attendee')
             {
                $('#tvisib').val('Private');
             }
             else
             {
                $('#tvisib').val('Public');
             }
             if($("#itemtype").find("option:selected").text()=='Seminars'&&document.querySelector('input[name="payradio"]:checked').value=='Free')
             {
             document.getElementById('ticketedsessiondiv').style.display='';
              $('input[name="ticketedsession"][value="true"]').attr("checked",true);
              }
             else
             document.getElementById('ticketedsessiondiv').style.display='none';
             }
             
             function editticketbadgelabelmoreinfo(titemtype)
                         {
                            
                            
                            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            titemtype,
            1,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                               
                                document.getElementById('tbdglabel').disabled="disabled";
                                document.getElementById('tbdgable').checked=false;
                             }
                           else{
                             document.getElementById('tbdglabel').disabled=false; 
                             document.getElementById('tbdgable').checked=true;
                         }
             });
             }
                            
                      </script>
                     
                    
                        
                      
                         <div class="elem">
                        <label for="ch_effects">Ticket visibility: </label>
                        
                     
                        <div class="indent">
                        <!--<input type="checkbox"  style="outline:none;" checked="checked"   id="tvisib" value="" />-->
                        <select class="selectlist" style="width:76%; padding:0px;" id="tvisib">
                            <apex:repeat value="{!Visibility}" var="vsb">
                            <option value="{!vsb.label}">{!vsb.value}
                            </option>
                            </apex:repeat>
                          </select>
                        </div>
             
                                   
                      </div>
                     
                        
                     <div class="elem">
                        <label for="ch_effects">Tax Rate: </label>
                        
                     
                        <div class="indent">
                        <input type="checkbox"  style="outline:none;" id="ttaxrate" value="" />
                        </div>
             
                                   
                      </div>
                    <div class="elem" id="ticketedsessiondiv" style="display:none">
                        <label for="ch_effects">Ticketed Session: </label>
                        
                     
                        <div class="indent">
                        <input checked="checked" onclick="unhideallsession()" name="ticketedsession" style="outline:none;" type="radio" value="true"/><span style="margin-left:5px; ">Yes</span>
                        <input name="ticketedsession" onchange="checkifsoldticketedsession(this);" style="outline:none;" type="radio" value="false"/><span style="margin-left:5px; ">No</span>
                        </div>
             
                                   
                      </div>
                    
                     
                    </div>
                    <!--close of left-form-->
<script>
function checkifsoldticketedsession(f)
{
try{
                              if(ticketlist[parentrowindex-1].grouptickets.length!=0)
                              if(ticketlist[parentrowindex-1].grouptickets[0].availabletickets!=="")
                               if(ticketlist[parentrowindex-1].grouptickets[0].availabletickets!=Number(ticketlist[parentrowindex-1].grouptickets[0].qty)&&$("#itemtype").find("option:selected").text()=='Seminars'&&String(ticketlist[parentrowindex-1].ticketedsession)!=String(document.querySelector('input[name="ticketedsession"]:checked').value)){
                                
                  if(String(document.querySelector('input[name="ticketedsession"]:checked').value)=="false")
                  {
                    alert("There are sold tickets, can't be changed to NO ticketed sessions.");
                    $('input[name="ticketedsession"][value="true"]').attr("checked",true);
                    return;
                  }
                  
                  }
                  }catch(e){}
                  Alertconfirm.render('The following change will be made to '+document.getElementById('tminfoname').value+' Seminar /Session ticket<br/>1. Pay Type  =  Free<br/>2. Ticket Visibility = Private<br/>3. Ticket Qty = 1<br/>4. Price = 0' , 'Confirmation',f,'Continue','Cancel','Alertconfirm');
}
</script>

<!--script for add tags flag------------------->
                    
                <script>
                  var flagexppp=0;
                function showet1(){
                if(flagexppp==0)
                        { 
                        flagexppp=1;
                        /*alert("block");*/
                            document.getElementById("tagcontentblock").style.display="";
                            
                        }
                        else if (flagexppp==1)
                        {
                            /*alert("hide");*/
                            flagexppp=0;
                            document.getElementById("tagcontentblock").style.display="none";
                             
                        
                        }
                        
            }
            
   var TagMap = {};  
   
   
   function getEventTags()
   {
        //code for adding existing event tags
   
    Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getEventTag}',
            eventmand.EventID,
            'Item_Pool__c',
           function(result, event){
           
           if (event.status){
                    var appendTxt = '';
                    $.each(result, function(i, resulteach){
                    TagMap[resulteach.Id]=resulteach.Tag_Text__c;
                   
                     $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+resulteach.Tag_Text__c+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                      
                       $('#abcpk').append('<table class="resultspk">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+resulteach.Tag_Text__c+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                        $('#abcpkitems').append('<table class="resultspl">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+resulteach.Tag_Text__c+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                   
                       
                   
                    console.log(TagMap);
                    });
                     $('#addtextlabel').val(''); //clearing textbox value
                      $('#addtextlabelpk').val(''); //clearing textbox value
                       $('#addtextlabelpkitems').val(''); //clearing textbox value
                    }
                    }
                    );
   }     
                
                </script>    
                   <!--------close of script---------------> 
                    <script type="text/javascript">//<![CDATA[ 
                    
$(window).load(function(){

                    
$(function() {
   $('#btn_s').click(function(e) {
     e.preventDefault();
     var name  = $('input[name="addtagtext"]').val()
if(name !==''){
//code for saving event tag
Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.createEventTag}',
            eventmand.EventID,
            name,
            'Item_Pool__c',
           function(result, event){
            if (event.status){
            if(result!=''){
             $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabel').val(''); //clearing textbox value
                    $('#abcpk').append('<table class="resultspk">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpk').val(''); //clearing textbox value
                    $('#abcpkitems').append('<table class="resultspl">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpkitems').val(''); //clearing textbox value
                    TagMap[result] = name;
                    console.log(TagMap);
                    }
                    else
                    {
                       //alert('Duplicate value');
                       AlertNew.render('Duplicate value' ,'Alert!','ok');
                    }
            }
           });
//
        /*alert('no value for addtagtext');*/
   //if($('.results').length < 1) {
      

 //  }
    }
   }
    );
    $('#btn_i').click(function() {
      $('.results').remove();  
    });
});
});//]]>  


 function addtagsshow(){
     document.getElementById("addtagtext").style.display="";
     document.getElementById("addtagsshow").style.display="none";
     
     }
</script>
                    <!------------------------->
               <style> 
         .close-dialog  
         {
           display:none;
         }   
    #tagwrapper {
        width:20%; height:auto; background-color:#ffffff; margin-left:13%; border-radius:3px;  position:absolute;margin-top: -2px;
        }               
     #tagtitleblock{
        width:100%; border:1px solid #D0D0D0; height:auto; border-radius:3px; padding:5px 0px;background :url({!URLFOR($Resource.createevents,'createevents/images/ul_playlist_li.png')} ) repeat-x center bottom #F5F5F5; 
         }             
          #tagtitleblock p{  
          font-size:13px; color: #424242; text-align:center;
           } 
           
           #addtagsdiv{width:100%; height:auto; padding-bottom:0px; background-color:#ffffff; padding-top:5px;}      
           /* Styles for results table */
.results {
  /*  width: 600px;*/
    width:95%; 
    margin:0px auto;
    margin-top: 0px;
    text-align:left;
    border: 0px solid #999;
    padding:3px;
    display:block; margin-bottom:5px;
    background-color:#F5F5F5;
    overflow:hidden;
}

.results td{ padding:0px 2px;}


.resultspl {
  /*  width: 600px;*/
    width:95%; 
    margin:0px auto;
    margin-top: 0px;
    text-align:left;
    border: 0px solid #999;
    padding:3px;
    display:block; margin-bottom:5px;
    background-color:#F5F5F5;
    overflow:hidden;
}

.resultspl td{ padding:0px 2px;}

        </style>                
                    <div class="right-form"  style=" width:49%; padding-bottom:20px; margin-top:15px;  border:0px #000000 solid; float:right">
                       <!--start of tags--->
                       <div style="float:left;">Tags:</div>
                       <div id="tagwrapper" style="">
                       
                       <div id="tagtitleblock" onClick="showet1()" style="">
                       
                       <p ><span><img src="  {!URLFOR($Resource.createevents,'createevents/images/check_black.png')}"  style="margin-right:5%;"/></span>Tags</p>
                       </div><!--close of tagtitleblock-->
         
          <div id="tagcontentblock" style="width:100%;height:auto; display:none; z-index:999999; border:1px solid #D0D0D0; border-top:0px; position:relative; background-color:#ffffff; ">
          
          
          <div id="addtagsdiv" style="">
          
           <!----------------------------------------------------->
            <div id="abc" style="width:100%;">


</div>

  <!--------------------------------------->
  <div style="display:block; border-top: 1px #E5E5E5 solid;border-bottom: 1px #E5E5E5 solid; background-color:#F7F7F7; text-align:center;font-size:18px; font-family:cuprum; color:#5283cc;">
    <div id="addtagsshow" onClick="addtagsshow()" >
     <span style="margin-right:10%;"><img src=" {!URLFOR($Resource.createevents,'createevents/images/addtag.png')}" width="18px" height="18px" style="margin-right:2%; margin-bottom:-3px;"/>Add Tags</span>
    </div>
    <table id="addtagtext" border="0" width="95%" style="margin:0px auto; margin-top:5px; margin-bottom:5px; display:none;">
    <tbody>
        <tr>
      <!--<td style="text-align:left">Tag Name</td>-->
      <td><input id="addtextlabel" type="text" name="addtagtext" placeholder="" style="width:80%;"/></td>
      <td>
       <div class="buttonHolder">   
    <input class="button-a blue"  type="button" name="submit" value="Save" onclick="" id="btn_s" />
    <!--<input class="button-a blue"  value="clear" type="button" id="btn_i">--> 
  </div></td>
      <!--<td><input type="checkbox" name="check"></td>-->
    
    </tr>
    
  </tbody></table>
  </div>
 
 
             <!-------------------------------------------------------->
          </div><!--close of addtagsdiv-->
           
           <div id="managetagbtn" onclick="AlertMT.render()"  style="width:100%; cursor:pointer; text-align:center; background-color:#F7F7F7; padding:5px 0px; font-size:18px; font-family:cuprum; color:#5283cc;">
           
           <img src=" {!URLFOR($Resource.createevents,'createevents/images/manage.png')}" width="20px" height="20px" style="margin-right:2%; margin-bottom:-3px;"/>Manage Tags
           
           </div><!--close of managetagbutton-->
          
          <!--------------------------------------------------------------------->
            </div><!--close of tagcontentblock-->
          
          </div><!--close of tagwrapper-->
                        <!--End of tags--->
                     
                      
                       <div class="elem" style="margin-top:25px;">
                        <label>Ticket Image:</label>
                        <div class="indent">
                            <div class="dropzone" >
                         <i title="Remove Image 1" class="clr_dropzone fa fa-times" style="display:none;" onclick="RemoveTicketImage()"></i>
                          <div id="savedticketimage">
<img  width="150" height="150" />
                          </div>
                          <input type="file" id="ticketlogo" title=" " onchange="checkticketlogo()"  accept="image/jpeg,image/png" style="width:95px;color:transparent;"/>
                        </div>

                        </div>
                      </div>
                        <div class="elem">
                        <label> Badgable:</label>
                        <div class="indent">
                          <input type="checkbox" id="tbdgable" value="" checked="checked" onchange="enablebadgelabel();"/>
                        </div>
                      </div>
                        <div class="elem">
                        <label> Badge Label:</label>
                        <div class="indent">
                          <input type="text" id="tbdglabel" value=""/>
                        </div>
                      </div>
                      <!------------------------------------->
                       <br/>
                       </div> <!--close of right-form-->
                       <div class="elem" style="margin-top:25px;">
                        <label>Ticket Description:</label>
                        <div class="indent">
                          <textarea class="medium" id="tdesc" name="tdesc" rows="5" style="width:75%"></textarea>
                        </div>
                      </div>
                    <script>

                 
function showet()
{

$(".dynamic3").find("tr:gt(0)").remove();
var appendTxt = "<tr><td><input type='text' id='one' name='input_box_one[]' placeholder='' value='"+earlybudname+" Early'/></td><td>  <input type='text' style='width:75%' class='datetimepickers' value='"+new Date().today()+" " + new Date().timeNow()+"'/></td><td><input type='text' style='width:75%' class='datetimepickers' id='elate1'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+earlybudqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+earlybudprice+"'/></td><td id='regticket' style='display:none;'><input type='button' class='del2' title='Delete Ticket' value='' /></td></tr>";
appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' placeholder='' value='"+earlybudname+" Regular'/></td><td>  <input type='text' style='width:75%' class='datetimepickers' id='estart2'/></td><td><input type='text' style='width:75%' class='datetimepickers' id='elate2'/></td><td><input type='text' id='three' name='input_box_three[]'  /></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  /></td><td id='regticket' style='display:none;'><input type='button' class='del2' title='Delete Ticket' value='' /></td></tr>";
appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' placeholder='' value='"+earlybudname+" Late'/></td><td>  <input type='text' style='width:75%' class='datetimepickers' id='estart3'/></td><td><input type='text' style='width:75%' class='datetimepickers' value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]'  /></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]' /></td><td id='regticket' style='display:none;'><input type='button' class='del2' title='Delete Ticket' value='' /></td></tr>";
$(".dynamic3 tbody").append(appendTxt);
try{
document.getElementById('elate1').onchange=function(){document.getElementById('estart2').value=document.getElementById('elate1').value};
document.getElementById('estart2').onchange=function(){document.getElementById('elate1').value=document.getElementById('estart2').value};
document.getElementById('elate2').onchange=function(){document.getElementById('estart3').value=document.getElementById('elate2').value};
document.getElementById('estart3').onchange=function(){document.getElementById('elate2').value=document.getElementById('estart3').value};
}catch(e){}
var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
        if(document.querySelector('input[name="payradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
       row.cells[6].children[0].disabled=false;
       }
       }
//document.getElementById("earlybirdbuttons").style.backgroundImage="none";
//document.getElementById("earlybirdbuttons").style.border="none";
//document.getElementById("earlybirdbuttons").style.outline="none";
document.getElementById("earlybirdtickpric").style.display="";
}
  
  function enablebadgelabel()
  {
   if(document.getElementById("tbdgable").checked==true){
   document.getElementById('tbdglabel').disabled=false;
   }
   else{
   document.getElementById('tbdglabel').value="";
   document.getElementById('tbdglabel').disabled="disabled";}
  }          
 </script>
                    
                    <div style="clear:both;"></div>
      <!--------------------------->
                      <div style="float:left; margin-bottom:10px;width:100%">
         <button id="earlybirdbuttons" class="button-a dark-blue" onClick="showet()"  style="background-color:#adadad;float:left">Early Bird Tickets</button>
         <div id="earlybirdtickpric" style="float: right; padding: 5px; border-radius: 3px; background-color: rgb(238, 238, 238);display:none">
              
              <table border="0">
  <tbody><tr>
    <td>Early Bird Ticket Pricing Display :</td>
    <td>   <input type="checkbox" style="outline:none;" checked="checked" value="" id="ebudprcflag"/></td>
  </tr>
</tbody></table>

                     </div>
         
               </div>
                   
          <!-------------------------------------------------->
  
                   <table class="display dynamic3" id="mytab1" style="width:100%; margin:0px auto; display:;">
            <thead>
              <tr>
                <th width="27%" style="padding:3px 0px 3px 2px; font-size:13px; text-indent:8px;">Ticket Name</th>
                <th width="15%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:8px;">Sale Start Date</th>
                <th width="15%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:8px;">Sale End Date</th>
                  <th width="11%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:8px;">Qty</th>
                  <th width="10%" style="padding:3px 0px 3px 2px;font-size:13px;;text-indent:0px;">Order Min-Qty</th>
                  <th width="10%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:0px;">Order Max-Qty</th>
                <th width="13%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:8px;">Price</th>
               
                <th id="regth" width="" style="display:none;"></th>
              </tr>
            </thead>
            
            <tbody>
          </tbody></table> 
          
       
                   
                    <div class="indent" style="float:right; margin-top:10px; margin-right:10px;"> 
   
                        <button class="button-a blue" onclick="saveticketalert();" >Apply</button>
                        <script>
                        function saveticketalert()
                        {
                          var table = document.getElementById("mytab1");
                                 for (var i = 1, row; row = table.rows[i]; i++) {
                                 try{
                                 var endTime = new Date(defaultendtime);
                                 var tendTime = new Date(row.cells[2].children[0].value);
                      if( tendTime>endTime){
                             //alert('Ticket End date cannot be greater than Event End date');
                             AlertNew.render('Ticket End date cannot be greater than Event End date' ,'Alert!','ok');
                             return;
                            }
                      }catch(e){
                      //alert(e);
                      AlertNew.render(e,'Alert!','ok');
                      }
                                 try{
                      var tstartTime = new Date(row.cells[1].children[0].value);
                      var tendTime = new Date(row.cells[2].children[0].value);
                      if( tstartTime > tendTime){
                             //alert('Start date cannot be greater than End date');
                             AlertNew.render('Start date cannot be greater than End date' ,'Alert!','ok');
                             return;
                            }
                      }catch(e){
                      //alert(e);
                      AlertNew.render(e,'Alert!','ok');
                      }
                      
                      if(Number(row.cells[1].children[0].value)==null ||Number(row.cells[1].children[0].value)=='')
                      {
                          alert('Please enter Sale Start Date');
                          //Alert.render('Please enter Sale Start Date','Alert','ok');
                          return;
                      }
                      if(Number(row.cells[2].children[0].value)==null ||Number(row.cells[2].children[0].value)=='')
                      {
                          //alert('Please enter Sale End Date');
                          AlertNew.render('Please enter Sale end Date','Alert!','ok');
                          return;
                      }
                      
                      if(Number(row.cells[3].children[0].value)==null ||Number(row.cells[3].children[0].value)=='')
                      {
                          //alert('Please enter the quantity');
                          AlertNew.render('Please enter the quantity' ,'Alert!','ok');
                          return;
                      }
                      if(Number(row.cells[5].children[0].value)>Number(row.cells[3].children[0].value))
                      {
                        //alert('Order Max-Qty cannot be greater than actual quantity');
                        AlertNew.render('Order Max-Qty cannot be greater than actual quantity','Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)>Number(row.cells[3].children[0].value))
                      {
                        
                        //alert('Order Min-Qty cannot be greater than actual quanity');
                        AlertNew.render('Order Min-Qty cannot be greater than actual quanity' ,'Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)>Number(row.cells[5].children[0].value))
                      {
                        
                        //alert('Order Min-Qty cannot be greater than Order Max-Qty');
                        AlertNew.render('Order Min-Qty cannot be greater than Order Max-Qty' ,'Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)<0)
                      {
                        
                        //alert('Order Min-Qty cannot be less than zero');
                        AlertNew.render('Order Min-Qty cannot be less than zero','Alert!','ok');
                        return;
                       
                        
                      }
                      
                      if(Number(row.cells[3].children[0].value)<=0||row.cells[3].children[0].value.trim()=='')
                         {
                        
                        //alert('Quantity cannot be less than 1 or blank');
                        AlertNew.render('Quantity cannot be less than 1 or blank' ,'Alert!','ok');
                        return;}
                        if(row.cells[6].children[0].value.trim()=='')
                         {
                        
                        //alert('Price cannot be blank');
                        AlertNew.render('Price cannot be blank' ,'Alert!','ok');
                        return;}
                        
                        if(Number(row.cells[6].children[0].value)==0&&document.querySelector('input[name="payradio"]:checked').value=='Paid')
                         {
                        
                        //alert('Price cannot be zero for paid tickets');
                        AlertNew.render('Price cannot be zero for paid tickets' ,'Alert!','ok');
                        return;}
                                 }
                          var alticksold=0;   
                          try{    
                          
                            for(var pi=0;pi<ticketlist.length;pi++) 
                        {
                             if(ticketlist[pi].trowid==parentrowindex)
                             {
                                 
                                 for(cl=0;cl<ticketlist[pi].grouptickets.length;cl++){
                                 if(ticketlist[pi].grouptickets[cl].qty!==""){ 
                        if(ticketlist[pi].grouptickets[cl].availabletickets!=Number(ticketlist[pi].grouptickets[cl].qty)&&ticketlist[pi].grouptickets[cl].availabletickets!==""){
               alticksold=1;
               }
               }
                          } 
                          
                          if(ticketlist[pi].itemtype!=document.getElementById('itemtype').value&&alticksold==1){
                          var origtype=$("#itemtype").find("option[value='"+ticketlist[pi].itemtype+"']").text();
                          var convertype=$("#itemtype").find("option:selected").text();
                          if(origtype=='Lead Retrieval'||origtype=='MatchLeads Buyer'||origtype=='MatchLeads Seller'||origtype=='Scan Attendee'||convertype=='Lead Retrieval'||convertype=='MatchLeads Buyer'||convertype=='MatchLeads Seller'||convertype=='Scan Attendee')
                          {
                          document.getElementById('itemtype').value=ticketlist[pi].itemtype;
                          try{
                          if(ticketlist[pi].tbadgable=='B - Badge')
                          document.getElementById('tbdgable').checked=true;
                          else
                          document.getElementById('tbdgable').checked=false;
                          document.getElementById('tbdglabel').value=ticketlist[pi].tbdglabel;
                          }catch(e){}
                          
                                alert('Sold ticket type cannot be changed for Eventdex Product');
                               try{
                               if($("#itemtype").find("option:selected").text()=='Seminars'&&document.querySelector('input[name="payradio"]:checked').value=='Free')
             {
             document.getElementById('ticketedsessiondiv').style.display='';
              $('input[name="ticketedsession"][value="true"]').attr("checked",true);
              }
             else
             document.getElementById('ticketedsessiondiv').style.display='none';
                               }catch(e){}
                                 return;
                                 }
                                }
                                
                             }
                             }   
                             }catch(e){}  
                                 
                                 
                                 
                           if(tckcontents=='')
                           {
                              getAll();
                              ticketlogourl='';
                              console.log(ticketlist);
                           }
                           else{
                           saveTicketLogo(tckcontents, IsUploadEventLogo);
                           document.getElementById('ticketloader').style.display='';}
                           
                            //saveTicketLogo(tckcontents, IsUploadEventLogo);
//document.getElementById('ticketloader').style.display='';
                           Alert3.Cancel();
                           setTicketDirtyFlag();
                        
                        $('#ticketloader').hide();
                           return false;
                        }
                        </script>
                        &nbsp;&nbsp;
                        <button class="button-a dark-blue" onclick="Alert3.Cancel()" >Cancel</button>
                      </div>
                        <apex:form >
      <apex:actionfunction name="saveTicketLogo" action="{!saveEventLogo}" status="AjaxLoader" rerender="reRenderedPanelToSetTicketVariable" oncomplete="getAll();document.getElementById('ticketloader').style.display='none';">
      <apex:param name="imageData" value="" assignTo="{!imageData}"/>
 <apex:param name="IsUploadEventLogo" value="" assignTo="{!IsUploadEventLogo}"/>
</apex:actionfunction></apex:form>
<apex:outputPanel id="reRenderedPanelToSetTicketVariable">
   <script type="text/javascript">
       
      ticketlogourl= "{!eventlogourl}";
      
   </script>
</apex:outputPanel>
                      <script>
                     var tckcontents='';
                        var ticketlogourl='';
                     var IsUploadEventLogo = false;

                     function checkticketlogo()
                     {
                          
                             var oFReader = new FileReader();
                     var f = document.getElementById("ticketlogo").files[0];
          

           if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
      tckcontents = e.target.result.split(',')[1];

IsUploadEventLogo = true;
                 
      }
      r.readAsDataURL(f);
     
    } else { 
      //alert("Failed to load file");
      AlertNew.render('Failed to load file' ,'Alert!','ok');
    }
    
                     }
                      

   function RemoveTicketImage(){
         IsUploadEventLogo = true;
 
         }
         
         
           function RemovePackageImage(){
         IsUploadEventLogo = true;
       
         }

                     function getAll()
                     {
                        
                                             
                        for(var pi=0;pi<ticketlist.length;pi++) 
                        {
                             if(ticketlist[pi].trowid==parentrowindex)
                             {
                                  //set the grouptickets array to null
                                 if(ticketlist[pi].grouptickets.length==0)
                                   ticketlist[pi].grouptickets=[];
                                   
                                 //Get the inner table values
                                 var table = document.getElementById("mytab1");
                                 for (var i = 1, row,nhiderow=0,totqty=0,totprice=0; row = table.rows[i]; i++) {
                                 if(row.style.display!='none'){
                       if(ticketlist[pi].grouptickets[nhiderow]==undefined)
                        ticketlist[pi].grouptickets.push({itemid:"",tname:"",sdate:"",edate:"",qty:"",minqty:"",maxqty:"",tprice:"",availabletickets:""})
                        ticketlist[pi].grouptickets[nhiderow].tname=row.cells[0].children[0].value;
                        ticketlist[pi].grouptickets[nhiderow].sdate=row.cells[1].children[0].value;
                        ticketlist[pi].grouptickets[nhiderow].edate=row.cells[2].children[0].value;
                         
                        ticketlist[pi].grouptickets[nhiderow].qty=row.cells[3].children[0].value;
                        ticketlist[pi].grouptickets[nhiderow].minqty=row.cells[4].children[0].value;
                        ticketlist[pi].grouptickets[nhiderow].maxqty=row.cells[5].children[0].value;
                        if(Number(ticketlist[pi].grouptickets[nhiderow].maxqty)>Number(ticketlist[pi].grouptickets[nhiderow].qty))
                        ticketlist[pi].grouptickets[nhiderow].maxqty=ticketlist[pi].grouptickets[nhiderow].qty;
                        ticketlist[pi].grouptickets[nhiderow].tprice=row.cells[6].children[0].value;
                        totqty+=Number(row.cells[3].children[0].value);
                        totprice+=Number(row.cells[6].children[0].value);
                        nhiderow++;
                        }
                             }
                             
                             ticketlist[pi].ticketcount=nhiderow;
                             ticketlist[pi].ticketedsession=document.querySelector('input[name="ticketedsession"]:checked').value;
                              ticketlist[pi].itemtype=document.getElementById('itemtype').value;
                             ticketlist[pi].ispackage="false";
                             if(ticketlist[pi].grouptickets.length==1)
                             document.getElementById('ticketname').value=ticketlist[pi].grouptickets[0].tname;
                             
                             document.getElementById("ticketqty").value=totqty;
                             if(ticketlist[pi].ticketcount>1)
                             document.getElementById("ticketprice").value='Group Tickets';
                             else
                             document.getElementById("ticketprice").value=totprice;
                             try{
                             if(document.getElementById('tminfoname').value==''&&ticketlist[pi].grouptickets.length==1)
                             document.getElementById('tminfoname').value=ticketlist[pi].grouptickets[0].tname;
                             document.getElementById("ticketname").value=document.getElementById('tminfoname').value;}catch(e){}
                             document.getElementById("tickettype").value=document.querySelector('input[name="payradio"]:checked').value;
                            checkfree(document.querySelector('input[name="payradio"]:checked').value);
                             ticketlist[pi].tvisib=$('#tvisib').val();
                             ticketlist[pi].taxrateflag=$('#ttaxrate').attr('checked');
                             ticketlist[pi].tebudprcflag=$('#ebudprcflag').attr('checked');
                             if(ticketlist[pi].grouptickets.length==1){
                             
                             ticketlist[pi].tebudprcflag=true;
                             }
                             ticketlist[pi].tdesc=$( "#tdesc" ).parent().children().eq(0).children().eq(0).children().eq(2).children().eq(0).contents().find('body').html();
                            
                             ticketlist[pi].tbdglabel=document.getElementById('tbdglabel').value;
                              /*Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            ticketlist[pi].itemtype,
            pi,
           function(result, event){
            ticketlist[result.arrindex].tbadgable=result.badgable;
             });*/
              if(document.getElementById("tbdgable").checked==true)
              ticketlist[pi].tbadgable='B - Badge';
              else               
              ticketlist[pi].tbadgable='N - No Badge';
  if(ticketlogourl!=''){
  ticketlist[pi].tcketlogo=ticketlogourl;
  tckcontents='';
  }
  else{
  if(IsUploadEventLogo){
  ticketlist[pi].tcketlogo= null;
  }
  }
                             //
                             
                             //set the tags array to null
                                   
                                  ticketlist[pi].tags=[];
                             //code for adding tags
                             var testimonialElements = $(".results");
                             
                             for(var f=0,tgindex=0; f<testimonialElements.length; f++){
                                  
                                  var element = testimonialElements.eq(f);
                                  if(element[0].children[0].children[0].children[0].children[0].checked){
                                  ticketlist[pi].tags.push({tagname:""});
                                  ticketlist[pi].tags[tgindex].tagname=getKeyByValue(TagMap,element[0].children[0].children[0].children[1].innerHTML);
                                  tgindex++;
                                  }
                                  }
                             //end of tags
                            
                        }
                        }
                         
                      
                     
                    }
                     </script>
                      
                    <!----dynamic table for tickets on the popup---->
                       
          <!------------------------------end of dynamic table------------>
                    <div class="clear"> </div>
                  </div><!--close of form-->
                   <!------------------->
                <div class="clear"> </div>
                </div><!--close of contentgrid-->
             
           </div><!--close of grid-1-->
           
            </div><!--close of dialogbox3-->
            
            
         <style>
     #blprodlink{background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(253,253,253,1)), color-stop(100%,rgba(227,227,227,1)));
background: -webkit-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -o-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -ms-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fdfdfd', endColorstr='#e3e3e3',GradientType=0 );
border: 1px solid #e3e3e3;
padding:5px; border-radius:3px; color:#3895ba; font-size:12px;}

 #blprodlink:hover{ text-decoration:none;}
 
 .pkgbttn{background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(253,253,253,1)), color-stop(100%,rgba(227,227,227,1)));
background: -webkit-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -o-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -ms-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fdfdfd', endColorstr='#e3e3e3',GradientType=0 );
border: 1px solid #e3e3e3;
padding:5px; border-radius:3px; color:#3895ba; font-size:12px; cursor:pointer; float:right; margin-bottom:10px; margin-top:-5px; margin-right:10px;}
 
 #boothleadsprodcontents table{ border-collapse:collapse; margin-left:1%;border: 1px solid #e3e3e3; margin-top:-3px;}
   #boothleadsprodcontents table tr td{ padding:0px 3px; border:none;}  
   #boothleadsprodcontents table tr{  border:none;}   
       </style>
       <style>
#tagwrapperpk {
width:20%; height:auto; background-color:#ffffff; margin-left:13%; border-radius:3px; position:absolute;margin-top: -2px;
}
#tagtitleblockpk{
width:100%; border:1px solid #D0D0D0; height:auto; border-radius:3px; padding:5px 0px;background: url({!URLFOR($Resource.createevents,'createevents/images/ul_playlist_li.png')} ) repeat-x center bottom #F5F5F5;
}
#tagtitleblockpk p{
font-size:13px; color: #424242; text-align:center;
}

#addtagsdiv{width:100%; height:auto; padding-bottom:0px; background-color:#ffffff; padding-top:5px;}
/* Styles for results table */
.resultspk {
/* width: 600px;*/
width:95%;
margin:0px auto;
margin-top: 0px;
text-align:left;
border: 0px solid #999;
padding:3px;
display:block; margin-bottom:5px;
background-color:#F5F5F5;
overflow:hidden;
}

.resultspk td{ padding:0px 2px;}



</style>         
<!--------------------------------close of more ticket info popup------------->
<!------------------------------package Moreinfo popup------------->
        <div id="dialogoverlay2"></div>
            <div id="dialogbox4">
          <a  id="close" onclick="Alert4.Cancel()" style="color: white;">×</a>
          

<!---tmore package info popup------------->
          
          
          <div id="morepackageinfo">
                     <div class="grid-1" style="text-align:left;"  >
                <div class="title-grid">Create Package</div>
                <div class="content-gird">
                  <div class="form"  style="font-size:13px;">
                    <div id="left-form" style=" width:49%; padding-bottom:20px; margin-top:15px;  border:0px #000000 solid; float:left">
                   
                    
                   
                      <div class="elem">
                        <label>Package Name: </label>
                        <label id="mandatory">*</label>
                        <div class="indent">
                          <input type="text"  id="pminfoname" name="pminfoname" class="medium"/>
                        </div>
                      </div>
                       <div class="elem">
                        <label>Package Type: </label>
                        <label id="mandatory">*</label>
                        <div class="indent">
                        <apex:repeat value="{!paymentSelectOptions}" var="paytype">
                        <input type="radio" onchange="validfreepack()"  style="outline:none;" checked="checked" name="pkgpayradio" value="{!paytype.value}"/><span style="margin-left:5px; ">{!paytype.label}</span><br/>
                        </apex:repeat>
                        <script>
                        function validfreepack()
                        {
                            var pmtable = document.getElementById("packagemoreinfotable");
       for (var p = 1,row; row = pmtable.rows[p]; p++) {
        if(document.querySelector('input[name="pkgpayradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
       row.cells[6].children[0].disabled=false;
       }
       }
       
                        }
                        </script>
                        </div>
                      </div>
                      
                     <div class="elem">
                        <label>Ticket Type:</label>
                        <div class="indent">
                        <apex:outputpanel id="pkitemtypeblock">
                          <select class="selectlist" style=" width:76%;" id="pkitemtype">
                          
                            <apex:repeat value="{!itemtypespackage}" var="ittype">
                            <option value="{!ittype.value}">{!ittype.label}
                            </option>
                            </apex:repeat>
                            
                            
                          </select>
                          </apex:outputpanel>
                        </div>
                      </div>
                      
                      <div class="elem">
                        <label>Package visibility: </label>
                         <div class="indent" style="margin-top:5px;">
                       <!--<input type="checkbox"  id="pkvisib" value="" />-->
                        <select class="selectlist" style="width:76%; padding:0px;" id="pkvisib">
                            <apex:repeat value="{!Visibility}" var="pvsb">
                            <option value="{!pvsb.label}">{!pvsb.value}
                            </option>
                            </apex:repeat>
                          </select>
                      </div>
                      </div>
                     <div class="elem">
                        <label for="ch_effects">Tax Rate: </label>
                        
                     
                        <div class="indent">
                        <input type="checkbox"  style="outline:none;" id="ptaxrate" value="" />
                        </div>
             
                                   
                      </div>
         
                     
                    </div>
                    <!--close of left-form-->
                    
                    <div class="right-form"  style=" width:49%; padding-bottom:20px; margin-top:15px;  border:0px #000000 solid; float:right">
                      <!---------------------PACKAGE TAGS------>
                   <div style="float:left;">Tags:</div>
                   <div id="tagwrapperpk" style="">
                       
                       <div id="tagtitleblockpk" onclick="showet2()" style="">
                       
                       <p style=""><span><img src="{!URLFOR($Resource.createevents,'createevents/images/check_black.png')}" style="margin-right:5%;"/></span>Tags</p>
                       </div><!--close of tagtitleblock1-->
         
          <div id="tagcontentblockpk" style="display:none;width: 100%; height: auto; z-index: 999999; border-width: 0px 1px 1px; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-right-color: rgb(208, 208, 208); border-bottom-color: rgb(208, 208, 208); border-left-color: rgb(208, 208, 208); position: relative; background-color: rgb(255, 255, 255);">
          
          
          <div id="addtagsdivpk" style="">
          
           <!----------------------------------------------------->
            <div id="abcpk" style="width:100%; padding-top:5px;">


</div>

<!--script for add tags flag------------------->
                    
                <script>
                  var flagexppp=0;
                function showet2(){
               
                if(flagexppp==0)
                        { 
                        flagexppp=1;
                        /*alert("block");*/
                            document.getElementById("tagcontentblockpk").style.display="";
                            
                        }
                        else if (flagexppp==1)
                        {
                            /*alert("hide");*/
                            flagexppp=0;
                            document.getElementById("tagcontentblockpk").style.display="none";
                             
                        
                        }
                        
            }
            
           
            
        
                
                </script>    
                   <!--------close of script---------------> 
                    <script type="text/javascript">//<![CDATA[ 
$(window).load(function(){
$(function() {
   $('#btn_spk').click(function(e) {
     e.preventDefault();
     var name  = $('input[name="addtagtextpk"]').val()
if(name !==''){
       Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.createEventTag}',
            eventmand.EventID,
            name,
            'Item_Pool__c',
           function(result, event){
            if (event.status){
            if(result!=''){
       $('#abcpk').append('<table class="resultspk">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpk').val(''); //clearing textbox value
                     $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabel').val(''); //clearing textbox value
                    $('#abcpkitems').append('<table class="resultspl">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpkitems').val(''); //clearing textbox value
                     TagMap[result] = name;
                    console.log(TagMap);
                    }
                    else
                    {
                       //alert('Duplicate value');
                       AlertNew.render('Duplicate value','Alert!','ok');
                    }
            }
           });

 //  }
    }
   }
    );
    $('#btn_ipk').click(function() {
      $('.resultspk').remove();  
    });
});
});//]]>  


 function addtagsshow2(){
     document.getElementById("addtagtextpk").style.display="";
     document.getElementById("addtagsshowpk").style.display="none";
     
     }
</script>
                    <!------------------------->


  <!--------------------------------------->
  <div style="display:block; border-top: 1px #E5E5E5 solid;border-bottom: 1px #E5E5E5 solid; background-color:#F7F7F7; text-align:center;font-size:18px; font-family:cuprum; color:#5283cc;" class="inactive">
    <div id="addtagsshowpk" onclick="addtagsshow2()" style="padding-top: 1px; display: none;">
     <span style="margin-right:10%;"><img src="images/addtag.png" width="18px" height="18px" style="margin-right:2%; margin-bottom:-3px;"/>Add Tags</span>
    </div>
    <table id="addtagtextpk" border="0" width="95%" style="margin: 5px auto;">
    <tbody>
        <tr>
      <!--<td style="text-align:left">Tag Name</td>-->
      <td><input id="addtextlabelpk" type="text" name="addtagtextpk" placeholder="" style="width:80%;"/></td>
      <td>
       <div class="buttonHolder">   
    <input class="button-a blue" type="button" name="submit" value="Save" onclick="" id="btn_spk"/>
    <!--<input class="button-a blue"  value="clear" type="button" id="btn_i">--> 
  </div></td>
      <!--<td><input type="checkbox" name="check"></td>-->
    
    </tr>
    
  </tbody></table>
  </div>
 
 
             <!-------------------------------------------------------->
          </div><!--close of addtagsdiv-->
           
           <div id="managetagbtn1" onclick="AlertMT.render()" style="width:100%; cursor:pointer; text-align:center; background-color:#F7F7F7; padding:5px 0px; font-size:18px; font-family:cuprum; color:#5283cc;">
           
           <img src="{!URLFOR($Resource.createevents,'createevents/images/manage.png')}" width="20px" height="20px" style="margin-right:2%; margin-bottom:-3px;"/>Manage Tags
           
           </div><!--close of managetagbutton-->
          
          <!--------------------------------------------------------------------->
            </div><!--close of tagcontentblock-->
          
          </div>
                   <!--END OF PACKAGE TAGS-->
                      
                        
                      
                       <div class="elem" style="padding-top: 25px; !important">
                        <label>Package Image:</label>
                        <div class="indent">





                          <div class="dropzone" >
                           <i title="Remove Image" class="clr_dropzone fa fa-times" style="display:none;" onclick="RemovePackageImage()"></i>
                            <div id="savedpackageimage">
                             <img  style="width: 150px; height:150px;"  />
                            </div>

                             <input type="file" id="pklogo" onchange="checkpackagelogo()" accept="image/jpeg,image/png" style="width:95px;color:transparent;"/>
                             

                          </div>
                        </div>
                      </div>
                      <br/>
                   
                    </div> <!--close of right-form-->
                    <div class="elem" style="margin-top:24px;">
                        <label>Package Description:</label>
                        <div class="indent">
                          <textarea class="medium" id="pkdesc" name="pkdesc" rows="5" style="width:75%"></textarea>
                        </div>
                      </div>
                     <script>
                 
function showetpck()
{

$(".dynamic4").find("tr:gt(0)").remove();
var appendTxt = "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+earlybudname+" Early'/></td> <td><input type='text' style='width:75%' class='datetimepickers' value='"+new Date().today()+" " + new Date().timeNow()+"'/></td><td><input type='text' style='width:75%' class='datetimepickers' id='elate1pck' /></td><td><input type='text' id='three' name='input_box_three[]' value='"+earlybudqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+earlybudprice+"'/></td></tr>";
appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+earlybudname+" Regular'/></td> <td><input type='text' style='width:75%' class='datetimepickers' id='estart2pck'/></td><td><input type='text' style='width:75%' class='datetimepickers'  id='elate2pck'/></td><td><input type='text' id='three' name='input_box_three[]' value=''/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]' value=''/></td></tr>";
appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+earlybudname+" Late'/></td> <td><input type='text' style='width:75%' class='datetimepickers' id='estart3pck'/></td><td><input type='text' style='width:75%' class='datetimepickers'  value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]' value=''/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]' value=''/></td></tr>";
$(".dynamic4 tbody").append(appendTxt);
try{
document.getElementById('elate1pck').onchange=function(){document.getElementById('estart2pck').value=document.getElementById('elate1pck').value};
document.getElementById('estart2pck').onchange=function(){document.getElementById('elate1pck').value=document.getElementById('estart2pck').value};
document.getElementById('elate2pck').onchange=function(){document.getElementById('estart3pck').value=document.getElementById('elate2pck').value};
document.getElementById('estart3pck').onchange=function(){document.getElementById('elate2pck').value=document.getElementById('estart3pck').value};
}catch(e){}

/*document.getElementById("optionspck").style.display="";
document.getElementById("options1pck").style.display="";
document.getElementById("regpck").style.display="";
document.getElementById("regtdpck").style.display="";
document.getElementById("earlybirdbuttons1").style.backgroundImage="none";
document.getElementById("earlybirdbuttons1").style.border="none";
document.getElementById("earlybirdbuttons1").style.outline="none";*/
document.getElementById("earlybirdpackkpric").style.display="";

}
            
 </script> 
 <div style="clear:both;"></div>
                    <div style="float:left; margin-bottom:10px;width:100%">
         <button id="earlybirdbuttons1" class="button-a dark-blue" onclick="showetpck()" style="background-color:#adadad;float:left">Early Bird Package</button>
         <div id="earlybirdpackkpric" style="float: right; padding: 5px; border-radius: 3px; background-color: rgb(238, 238, 238);display:none">
              
              <table border="0">
  <tbody><tr>
    <td>Early Bird Package Pricing Display :</td>
    <td>   <input type="checkbox" style="outline:none;" checked="checked" value="" id="pebudprcflag"/></td>
  </tr>
</tbody></table>

                     </div>
               </div>
                    
                     <table class="display dynamic4" id="packagemoreinfotable" style="width:100%; margin:0px auto;">
            <thead>
              <tr>
                <th width="28%" style="padding:3px 0px 3px 2px; text-indent:5px;">Package Item Name</th>
                <th width="15%" style="padding:3px 0px 3px 2px;text-indent:5px;">Start Date</th>
                <th width="15%" style="padding:3px 0px 3px 2px;text-indent:5px;">End Date</th>
                  <th width="11%" style="padding:3px 0px 3px 2px;text-indent:5px;">Qty</th>
               <th width="10%" style="padding:3px 0px 3px 2px;font-size:13px;;text-indent:0px;">Order Min-Qty</th>
                  <th width="10%" style="padding:3px 0px 3px 2px;font-size:13px;text-indent:0px;">Order Max-Qty</th>
                 <th width="15%" style="padding:3px 0px 3px 2px;text-indent:5px;">Price</th>
                 <!--<th id="regpck" width="" ><input type='button' class='add3' value='' /></th>-->
              </tr>
            </thead>
            <tbody>
                 
                       
            
            
          </tbody></table>
        
                <div class="indent" style="float:right; margin-top:10px; margin-right:10px;"> 
   
                        <button class="button-a blue" onclick="calpackagegrouptotal()">Apply</button>
                        <button class="button-a dark-blue" onclick="cancelpackagegrouptotal()">Cancel</button>
                        <script>
                        function cancelpackagegrouptotal()
                        {
                           var rowindex;
      if(isnewpackage=="true")
       rowindex=$(".dynamic tr:last").index()+1;
        else
       rowindex=parentrowindex-1;
       var appendTxt='';
       var totprice=0,totqty=0;
       for(var j=0,count=0;j<ticketlist[rowindex].ticketcount;j++)
           {
             
          appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(ticketlist[rowindex].grouptickets[j].tname)+"'/></td> <td><input type='text' style='width:75%' class='datetimepickers' value='"+ticketlist[rowindex].grouptickets[j].sdate+"'/></td><td><input type='text' style='width:75%' class='datetimepickers'  value='"+ticketlist[rowindex].grouptickets[j].edate+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[rowindex].grouptickets[j].qty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[rowindex].grouptickets[j].minqty+"'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+ticketlist[rowindex].grouptickets[j].maxqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[rowindex].grouptickets[j].tprice+"'/></td></tr>";
           totqty+=Number(ticketlist[rowindex].grouptickets[j].qty);
              totprice+=Number(ticketlist[rowindex].grouptickets[j].tprice);
              count++;
           }
           if(appendTxt!=''){
           $(".dynamic4").find("tr:gt(0)").remove();
      $(".dynamic4 tbody").append(appendTxt);}
      else
      {
           var datetime =new Date().today()+" " + new Date().timeNow();
     var txt= "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(earlybudname)+"'/></td> <td><input type='text' style='width:75%' class='datetimepickers' value='"+datetime+"'/></td><td><input type='text' style='width:75%' class='datetimepickers'  value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+earlybudqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='{!itemdefaultmaxqty}'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+earlybudprice+"'/></td></tr>";
      $(".dynamic4").find("tr:gt(0)").remove();
      $(".dynamic4 tbody").append(txt);
      }
      
      if(appendTxt!=''){
       if(count>1)
                             document.getElementById('packageprice').value='Group Packages';
                             else
                             document.getElementById('packageprice').value=totprice;
               document.getElementById('packageqty').value=totqty;
               checkfreepackage(document.getElementById('packagetype').value);
               }
       Alert4.Cancel();
                        }
                        function calpackagegrouptotal()
                        {
                             var table = document.getElementById("packagemoreinfotable");
                             
                             var totprice=0,totqty=0;
                             for (var i = 1, row,nhiderow=0; row = table.rows[i]; i++) {
       
        if(row.style.display!='none'){
              totqty+=Number(row.cells[3].children[0].value);
              totprice+=Number(row.cells[6].children[0].value);
              try{
                                 var endTime = new Date(defaultendtime);
                                 var tendTime = new Date(row.cells[2].children[0].value);
                      if( tendTime>endTime){
                             //alert('Package End date cannot be greater than Event End date');
                             AlertNew.render('Package End date cannot be greater than Event End date','Alert!','ok');
                             return;
                            }
                      }catch(e){
                      //alert(e);
                      AlertNew.render(e,'Alert!','ok');
                      }
              try{
                      var pstartTime = new Date(row.cells[1].children[0].value);
                      var pendTime = new Date(row.cells[2].children[0].value);
                      if( pstartTime > pendTime){
                             //alert('Start date cannot be greater than End date');
                             AlertNew.render('Start date cannot be greater than End date' ,'Alert!','ok');
                             return;
                            }
                      }catch(e){
                      //alert(e);
                      AlertNew.render(e,'Alert!','ok');
                      }
                      if(Number(row.cells[1].children[0].value)==null ||Number(row.cells[1].children[0].value)=='')
                      {
                          //alert('Please enter Sale Start Date');
                          AlertNew.render('Please enter Sale Start Date','Alert!','ok');
                          return;
                      }
                      if(Number(row.cells[2].children[0].value)==null ||Number(row.cells[2].children[0].value)=='')
                      {
                          //alert('Please enter Sale End Date');
                          AlertNew.render('Please enter Sale End Date','Alert!','ok');
                          return;
                      }
                      
                      if(Number(row.cells[3].children[0].value)==null ||Number(row.cells[3].children[0].value)=='')
                      {
                          //alert('Please enter the quantity');
                          AlertNew.render('Please enter the quantity' ,'Alert!','ok');
                          return;
                      }
                      if(Number(row.cells[5].children[0].value)>Number(row.cells[3].children[0].value))
                      {
                        
                        //alert('Order Max-Qty cannot be greater than actual quanity');
                        AlertNew.render('Order Max-Qty cannot be greater than actual quanity','Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)>Number(row.cells[3].children[0].value))
                      {
                        
                        //alert('Order Min-Qty cannot be greater than actual quanity');
                        AlertNew.render('Order Min-Qty cannot be greater than actual quanity','Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)>Number(row.cells[5].children[0].value))
                      {
                        
                        //alert('Order Min-Qty cannot be greater than Order Max-Qty');
                        AlertNew.render('Order Min-Qty cannot be greater than Order Max-Qty' ,'Alert!','ok');
                        return;
                       
                        
                      }
                      if(Number(row.cells[4].children[0].value)<0)
                      {
                        
                        //alert('Order Min-Qty cannot be less than zero');
                        AlertNew.render('Order Min-Qty cannot be less than zero' ,'Alert!','ok');
                        return;
                       
                        
                      }
                 if(Number(row.cells[3].children[0].value)<=0||row.cells[3].children[0].value.trim()=='')
                         {
                        
                        //alert('Quantity cannot be less than 1 or blank');
                        AlertNew.render('Quantity cannot be less than 1 or blank' ,'Alert!','ok');
                        return;}
                        if(row.cells[6].children[0].value.trim()=='')
                         {
                        
                        //alert('Price cannot be blank');
                        AlertNew.render('Price cannot be blank','Alert!','ok');
                        return;}
                        
                        if(Number(row.cells[6].children[0].value)==0&&document.querySelector('input[name="pkgpayradio"]:checked').value=='Paid')
                         {
                        
                        //alert('Price cannot be zero for paid package');
                        AlertNew.render('Price cannot be zero for paid package' ,'Alert!','ok');
                        return;}
              nhiderow++;
         }
       }
       if(nhiderow>1)
                             document.getElementById('packageprice').value='Group Packages';
                             else
                             document.getElementById('packageprice').value=totprice;
               document.getElementById('packageqty').value=totqty;
               document.getElementById('packagetype').value=document.querySelector('input[name="pkgpayradio"]:checked').value;
               checkfreepackage(document.getElementById('packagetype').value);
               try
               {
               document.getElementById('packagename').value=document.getElementById('pminfoname').value;
               }catch(e){}
        Alert4.Cancel();
                        }
                        </script>
           </div>      
                   
                   
                      
                    <!----dynamic table for tickets on the popup---->
                       
          <!------------------------------end of dynamic table------------>
                    <div class="clear"> </div>
                  </div><!--close of form-->
             
                  <div class="clear"> </div>
                </div><!--close of contentgrid-->
           </div>
            </div>
            
            
            <!--close of more package info popup------------->
          
          </div><!--close of dialogbox4--------->
<!---------------------------end of package moreinfo content popup------------------>

          
          <div id="package1" style="width:99%; margin:0px auto; margin-top:20px;  height:auto; display:none;"> 
        
          
           <div class="grid-1" style=" width:100%; margin-left:0px;"  >
          <div class="title-grid1" style=" border:0px solid #000;"><span></span>
          <img src="{!URLFOR($Resource.createevents,'createevents/images/redheaderbg.png')}"  style="margin-top:-8px; 
          margin-left:-2%;"/> <p style="color:#FFF; font-size:16px; font-family:segoe ui; margin-top:-34px;">Create Package </p>
          
        </div><!--close of title-grid1-->
         <script>
          function checkfreepackage(vs)
          {
             if(vs=='Free')
             {
             if(document.getElementById('packageprice').value!='Group Packages')
             document.getElementById('packageprice').value=0;
             document.getElementById('packageprice').disabled="disabled";
             }
             else
             document.getElementById('packageprice').disabled=false;
          }
          </script>  
          <div class="content-gird"  style=" border: 0px solid #e3e3e3;  padding:0px;">
           <!----------------------Dynamic Table for Package-------------------------->
            <table width="100%" border="0" style="border-collapse:collapse;  background-color:#F6F6F6; padding:5px; border-top: 1px solid #BDBDBD;border-bottom: 0px solid #BDBDBD; font-size:13px; color:#424242; 
          font-family:Arial, Helvetica, sans-serif;">
          <tr>
          <td  style="font-size:17px; text-align:left;  text-indent:10px; color: #4f91cd;font-family:cuprum">1.</td>
    <td width="10%" height="55px"  style="texr-indent:5px; text-align:right;">Package Name:</td>
    <td width="20%" style="">      <input type="text"  id="packagename" name="packagename" class="medium" onKeyUp="pkgnmkeyupvalid()" onBlur="pkgnmblurvalid()"
  style="width:78%;margin-left:10px;"/></td>
   
    <td width="12%" style="text-align:right;">Package Type:</td>
    <td width="10%">      <select class="selectlist" style="outline:none;margin-left:10px;" id="packagetype" onchange="checkfreepackage(this.value);">
                  <apex:repeat value="{!paymentSelectOptions}" var="paytype">
                  <option value='{!paytype.value}'>{!paytype.label}</option>
                  </apex:repeat>
                </select></td>
     <td width="10%" height="55px" style="text-align:right;">Quantity:</td>
    <td width="10%">      <input type="text"  id="packageqty" name="packageqty" class="medium" style="margin-left:10px;width:80%;" onKeyUp="pkgqtykeyupvalid()" onBlur="pkgqtyblurvalid()"/></td>
<td width="10%" style="text-align:right;">Price:</td>
    <td width="10%">      <input type="text"  id="packageprice" name="packageprice" class="medium" style="margin-left:10px; width:60%;" onKeyUp="pkgpricekeyupvalid()" onBlur="pkgpriceblurvalid()"
/></td>
  <td  >
  <a onClick="Alert4.render(this.parentNode.parentNode.children[2].children[0].value,this.parentNode.parentNode.children[8].children[0].value,this.parentNode.parentNode.children[6].children[0].value,this.parentNode.parentNode.children[4].children[0].value)">
  <div id="nwmoreinfodiv">
 <apex:image url="{!URLFOR($Resource.createevents,'createevents/images/addmore.png')}" width="25px" height="25px"/>
 </div>
   </a>
  <!--<a href="#" style="text-decoration:none;color: #FFF;" data-reveal-id="morepackageinfo" data-animation="none">
   <img id="ticketinfo" src="creditcards/document_add.png" title="Add more info">
   </a> -->
 </td>
  </tr>
  
 
  
</table>
<!--------------------------------------------------------------------------> 
          
          <table class="display dynamic2" id="packagetable" style="width:100%; margin:0px auto; margin-top:0px;" >
            <thead>
              <tr>
                <th width="26%" style="padding:3px 0px 3px 2px; text-indent:5px;">Package Item Name</th>
              
                <th width="13%" style="padding:3px 0px 3px 2px;text-indent:5px;">Package Item Qty</th>
                 <!-- <th width="11%" style="padding:3px 0px 3px 2px;text-indent:5px;">Price</th>-->
                <th width="20%" style="padding:3px 0px 3px 2px;text-indent:5px;">Ticket Type</th>
             <!--   <th width="9%" style="padding:3px 0px 3px 2px;text-indent:5px; ">More Info</th>-->
             <th width="8%" style="padding:3px 0px 3px 2px;text-indent:5px;">Tags</th>
             <th width="8%" style="padding:3px 0px 3px 2px;text-indent:5px;">Badgable</th>
                  <th width="20%" style="padding:3px 0px 3px 2px;text-indent:5px;">Badge label</th>
   
                  
                <th width=""><a class="add1" title="Add Package Item" style="color:#807f7f; text-decoration:none;"><img src="{!URLFOR($Resource.createevents,'createevents/images/addrow.png')}" width="18" height="18" style="margin-right:5px; margin-bottom:-5px;"/><!--Add Package Item--></a></th>
              </tr>
            </thead>
            <tbody></tbody>
            
          </table>
          <!-------------------------------->   
           <div style="margin-bottom:5px; text-align:right;background-color:#F6F6F6;">
   
                        <button class="button-a blue" onClick="pkgvalid();return false;" >Save</button>
                        &nbsp;&nbsp;
                        <button class="button-a dark-blue" onClick="showclose('package1','dynamictickets');try{document.getElementById('ticketpagepaymentoption').style.display='block';document.getElementById('ticketpagesavebutton').style.display='block';}catch(e){}" >Cancel</button>
               </div>
                      
          
          
          </div></div>
          
          </div>
          
           
          <!------------------------End of create Package Div------------------------->  
          <script>
          function checkfree(vs)
          {
             if(vs=='Free')
             {
             if(document.getElementById('ticketprice').value!='Group Tickets')
             document.getElementById('ticketprice').value=0;
             document.getElementById('ticketprice').disabled="disabled";
             }
             else
             document.getElementById('ticketprice').disabled=false;
          }
          </script> 
          <!--Create new ticket screen-->
<div id="ticket1" style="width:99%; margin:0px auto; margin-top:20px;  height:auto; display:none;"> 
         
      
           <div class="grid-1" style=" width:100%; margin-left:0px;"  >
          <div class="title-grid1" style=" border:0px solid #000;"><span></span>
          <img src="{!URLFOR($Resource.createevents,'createevents/images/redheaderbg.png')}"  style="margin-top:-8px; 
          margin-left:-2%;"/> <p style="color:#FFF; font-size:16px; font-family:segoe ui; margin-top:-34px;">Create Ticket </p>
          
        </div><!--close of title-grid1-->
          
          <div class="content-gird"  style=" border: 0px solid #e3e3e3;  padding:0px;">
           <!----------------------Dynamic Table for Ticket-------------------------->
            <table width="100%" border="0" style="border-collapse:collapse;  background-color:#F6F6F6; padding:5px; border-top: 1px solid #BDBDBD;border-bottom: 0px solid #BDBDBD; font-size:13px; color:#424242; 
          font-family:Arial, Helvetica, sans-serif;">
          <tr>
          <td  style="font-size:17px; text-align:left;  text-indent:10px; color: #4f91cd;font-family:cuprum">1.</td>
    <td width="10%" height="55px"  style="texr-indent:5px; text-align:right;">Ticket Name:</td>
    <td width="20%" style="">      <input type="text"  id="ticketname" name="ticketname" class="medium" style="width:78%;margin-left:10px;"/></td>
    <td width="10%" style="text-align:right;">Ticket Pay Type:</td>
   <td width="12%"><select class="selectlist" style="outline:none;margin-left:10px;" id="tickettype" onchange="checkfree(this.value);">
                  <apex:variable var="listcou" value="{!0}" id="listcountid"/>
                  <apex:repeat value="{!paymentSelectOptions}" var="paytype">
                  <apex:variable var="listcou" value="{!listcou+1}"/>
                  <option value='{!paytype.value}'>{!paytype.label}</option>
                  </apex:repeat>
                </select></td>
     <td width="8%" height="55px" style="text-align:right;">Quantity:</td>
    <td width="10%">      <input type="text"  id="ticketqty" name="ticketqty" class="medium" style="margin-left:10px;width:80%;"/></td>
<td width="5%" style="text-align:right;">Price:</td>
    <td width="15%">      <input type="text"  id="ticketprice" name="ticketprice" class="medium" style="margin-left:10px; width:60%;" /></td>
    
  <td  >
  <a onClick="Alert3.render(parentrowindex,this.parentNode.parentNode.children[2].children[0].value,this.parentNode.parentNode.children[4].children[0].value,this.parentNode.parentNode.children[6].children[0].value,this.parentNode.parentNode.children[8].children[0].value)">
  <div >
 <apex:image url="{!URLFOR($Resource.createevents,'createevents/images/addmore.png')}" width="25px" height="25px"/>
 </div>
   </a>
  <!--<a href="#" style="text-decoration:none;color: #FFF;" data-reveal-id="morepackageinfo" data-animation="none">
   <img id="ticketinfo" src="creditcards/document_add.png" title="Add more info">
   </a> -->
 </td>
  </tr>
  
 
  
</table>

           <div style="margin-bottom:5px; text-align:right;background-color:#F6F6F6;">
   
                        <button class="button-a blue" onClick="ticketvalid();return false;" >Save</button>
                        &nbsp;&nbsp;
                        <button class="button-a dark-blue" onClick="showclose('ticket1','dynamictickets');try{document.getElementById('ticketpagepaymentoption').style.display='block';document.getElementById('ticketpagesavebutton').style.display='block';}catch(e){}" >Cancel</button>
               </div>
                      
          
          
          </div></div>
          
          </div>
          <!--End of Create new ticket screen-->
          
          
          <script>
          var ticketsold=false;
           function mask1()
   {
       try{
       document.getElementById("mask2overlay").style.display="none"; 
       }catch(e){}
      
          //if(sessionStorage.getItem('ticket')==null)
 //{
      if('{!$CurrentPage.parameters.id}'!='')
 eventmand.EventID='{!$CurrentPage.parameters.id}';
  try{
   ShowLoader();
     
      }catch(e){}
          
        //Get all available item pools
        var itpoolid=[];
        var itpoolname=[];
Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getSavedTickets}',
            eventmand.EventID,
           function(result, event){
           var j = 1,arrindex=0;
          $.each(result, function(i, resulteach){
          
          
          
          ticketlist[arrindex].poolid=resulteach.Id;
                ticketlist[arrindex].tname=resulteach.Item_Pool_Name__c;
                ticketlist[arrindex].ticketedsession=resulteach.Ticketed_Sessions__c;
                itpoolid[arrindex]=resulteach.Id;
                itpoolname[arrindex]=resulteach.Name;
                ticketlist[arrindex].tqty=resulteach.Item_Count__c;
                if(resulteach.Package_Flag__c=='I - Individual Item pool')
                ticketlist[arrindex].ispackage='false';
                else
                ticketlist[arrindex].ispackage='true';
                ticketlist[arrindex].itemtype=resulteach.Item_Type__c;
                ticketlist[arrindex].tbdglabel=resulteach.Badge_Label__c==undefined?'':resulteach.Badge_Label__c;
                ticketlist[arrindex].tbadgable=resulteach.Badgable__c==undefined?'':resulteach.Badgable__c;
                ticketlist[arrindex].trowid=j;
               arrindex++;
                j++;
                
                console.log(resulteach);
                });
              
         //Get Items
           for(k=0;k<itpoolid.length;k++)
           {
              //Get Items/Group Tickets
                Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getnewItemsBasedOnPool}',
            itpoolid[k],
            eventmand.EventID,
           function(result1, event1){
           var ik=0,totqty=0,totprice=0;
           $.each(result1, function(i1, resulteach1){
           for(l=0;l<itpoolid.length;l++){
           if(resulteach1.ite.Item_Pool__c==itpoolid[l]){
           ticketlist[l].grouptickets.push({itemid:"",tname:"",sdate:"",edate:"",qty:"",minqty:"",maxqty:"",tprice:"",availabletickets:""});
           ticketlist[l].tcketlogo=resulteach1.ite.image_url__c;
           ticketlist[l].grouptickets[ik].availabletickets=resulteach1.ite.Available_Tickets__c;
           ticketlist[l].grouptickets[ik].itemid=resulteach1.ite.Id;
           ticketlist[l].grouptickets[ik].tname=resulteach1.ite.item_name__c;
           
            /*Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getTimeZoneValueforitem}',
            eventmand.EventID,
            resulteach1.sale_start__c,
            resulteach1.sale_end__c,
            l,
            ik,
           function(resulted, eventd){
           var eddates=resulted.itdate;
           var res = eddates.split(",");
          
           ticketlist[resulted.l].grouptickets[resulted.ik].sdate=res[0];
           ticketlist[resulted.l].grouptickets[resulted.ik].edate=res[1];
          
           });*/
           ticketlist[l].grouptickets[ik].sdate=resulteach1.startdate;
           ticketlist[l].grouptickets[ik].edate=resulteach1.enddate;
           if(resulteach1.ite.item_count__c!=resulteach1.ite.Available_Tickets__c)
           ticketsold=true;
           ticketlist[l].grouptickets[ik].qty=resulteach1.ite.item_count__c;
           ticketlist[l].grouptickets[ik].minqty=resulteach1.ite.min_per_order__c;
           ticketlist[l].grouptickets[ik].maxqty=resulteach1.ite.max_per_order__c;
           totqty+=resulteach1.ite.item_count__c;
           totprice+=resulteach1.ite.price__c;
           
           ticketlist[l].grouptickets[ik].tprice=resulteach1.ite.price__c;
           ik++;
           ticketlist[l].ticketcount=ik;
           
           ticketlist[l].tprice=totprice;
             if(ik>1)
             {
             if(ticketlist[l].ispackage=='true')
             ticketlist[l].tprice='Group Packages';
             else
             ticketlist[l].tprice='Group Tickets';
             }
             ticketlist[l].tpaytype=resulteach1.ite.Payment__c;
             ticketlist[l].tvisib=resulteach1.ite.Visibility__c;
             ticketlist[l].taxrateflag=resulteach1.ite.Taxable__c;
              ticketlist[l].tebudprcflag=resulteach1.ite.Early_Bird_Pricing_Display_Flag__c;
             ticketlist[l].tdesc=$('<textarea />').html(resulteach1.ite.Description__c==undefined?'':resulteach1.ite.Description__c).text();
               }
           }
           });
           
          
           sessionStorage['ticket']=JSON.stringify(ticketlist);
           getTicketState();
           try{
           if(document.getElementById('meventstat').value=='Live')
           show('payment');
           
           
           }catch(e){}
           try{
           if($('input:radio[name=evestat]:checked').val()=='Live')
           show('payment');
           
           
           }catch(e){}
           
           
           try{ticketclick=false; }catch(e){}
           try{HideLoader();}catch(e){}
           });  
           
            //Get Addon Item Pools
           Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getAddonPool}',
            itpoolid[k],
           function(result2, event2){
           console.log(result2);
           var ik1=0;
           $.each(result2, function(i2, resulteach2){
           for(m=0;m<itpoolid.length;m++){
           if(resulteach2.Addon_Parent__c==itpoolid[m]){
           ticketlist[m].subpackagegroup.push({addonid:"",pkgitemname:"",pkgitemqty:"",ttype:"",badgelabel:"",badgable:""});
           ticketlist[m].subpackagegroup[ik1].addonid=resulteach2.Id;
          var elem = document.createElement('textarea');
          elem.innerHTML = resulteach2.Item_Pool_Name__c;
          var decoded = elem.value;
           ticketlist[m].subpackagegroup[ik1].pkgitemname=decoded;
           ticketlist[m].subpackagegroup[ik1].pkgitemqty=resulteach2.Addon_Count__c;
           ticketlist[m].subpackagegroup[ik1].ttype=resulteach2.Item_Type__c;
           ticketlist[m].subpackagegroup[ik1].badgelabel=resulteach2.Badge_Label__c==undefined?'':resulteach2.Badge_Label__c;
           ticketlist[m].subpackagegroup[ik1].badgable=resulteach2.Badgable__c==undefined?'':resulteach2.Badgable__c;
           ticketlist[m].subpackagegroup[ik1].tags=[];
           try{
           for(b=0;b<resulteach2.BLN_Event_Tags__r.length;b++)
           {
             
             ticketlist[m].subpackagegroup[ik1].tags.push({tagname:""});
            ticketlist[m].subpackagegroup[ik1].tags[b].tagname=resulteach2.BLN_Event_Tags__r[b].ParentId__c;
           }
           }catch(e){}
           
           ik1++;
               }
           }
           });
           
          
           sessionStorage['ticket']=JSON.stringify(ticketlist);
           getTicketState();
           try{
           if(document.getElementById('meventstat').value=='Live')
           show('payment');
           
           }catch(e){}
           try{
           if($('input:radio[name=evestat]:checked').val()=='Live')
           show('payment');
           
           
           }catch(e){}
           
           });  
           //End Of Get Addon Item Pools   
           }//end of itpoolid loop
           
            Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getSavedTags}',
            eventmand.EventID,
           function(result3, event3){
           
           //var set = [];
          $.each(result3, function(i3, resulteach3){
          /*var setflag=0;
          for(seti=0;seti<set.length;seti++)
          {
             if(resulteach3.Tag_Id__c==set[seti])
             setflag=1;
          }
          
            if (setflag==0) { 
                 set.push(resulteach3.Tag_Id__c);
               }*/
                          
                          for(mt=0;mt<itpoolid.length;mt++){
                          if(resulteach3.RowId__c==itpoolid[mt]){
                          
                          ticketlist[mt].tags.push({tagname:resulteach3.ParentId__c});
                          
                                  }
                          }
            });
            
            /*for(tagi=0;tagi<set.length;tagi++){
            $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+set[tagi]+'</td>'
                            
                           +'</tr>'
                       + '</table>');}*/
            sessionStorage['ticket']=JSON.stringify(ticketlist);
           getTicketState();
            });
           if(itpoolid.length==0)
           try{HideLoader();}catch(e){}
            }, 
            {escape: true}
        );
sessionStorage['ticket']=JSON.stringify(ticketlist); 
         //}
         
         if(sessionStorage['ticketcopy']!=null)
         {
         console.log(sessionStorage.getItem('ticketcopy'));
           sessionStorage['ticket']=sessionStorage.getItem('ticketcopy');
           boothleadproduct=JSON.parse(sessionStorage.getItem('blps'));
           sessionStorage['ticketcopy']=null;
           sessionStorage['blps']=null;
           sessionStorage.removeItem("ticketcopy");
           sessionStorage.removeItem("blps");
           }
          getTicketState();
          try{
  showwhich();
  }catch(e){}
  try{
           if(document.getElementById('meventstat').value=='Live')
           show('payment');
           
           
           }catch(e){}
           try{
           if($('input:radio[name=evestat]:checked').val()=='Live')
           show('payment');
           
           
           }catch(e){}
   }
          
          
          
 
          var ticketlist=[]; 
            for(var loopi=0;loopi<60;loopi++)
{
ticketlist.push({poolid:"",tname:"",tpaytype:"",tqty:"",tprice:"",tvisib:"",tdesc:"",ticketedsession:"",tcketlogo:"",tbdglabel:"",tbadgable:"",trowid:"",grouptickets:[],ticketcount:"",tags:[],subpackagegroup:[],ispackage:"",itemtype:"",taxrateflag:"",tebudprcflag:""});
}

   function getTicketState()
   {
        if(sessionStorage['ticket']!=null){
   
   var temp = sessionStorage.getItem('ticket');
    console.log('temp '+temp);
   
    ticketlist= $.parseJSON(temp);
   
   
   
    var appendTxt='';
     var apvar=0;
    for(var p=0;p<ticketlist.length;p++)
    {
        
       if(ticketlist[p].trowid!=''){
      if(ticketlist[p].ispackage=="false")
      appendTxt += "<tr><td><img src='{!$Resource.DragButton}'  style='margin-left:-5px;margin-right:5px;'/><input type='text' id='one' class='tickfield' name='input_box_one[]' onkeypress='setTicketDirtyFlag();' disabled='disabled' value='"+ticketlist[p].tname+"'></td> <td><SELECT disabled='disabled' onchange='setTicketDirtyFlag();' class=' selectlist ' NAME=\"Animal\" id='ppptype"+apvar+"'><apex:repeat value="{!paymentSelectOptions}" var="paytype"><option value='{!paytype.value}'>{!paytype.label}</option></apex:repeat></SELECT><script>document.getElementById('ppptype"+apvar+"').value='"+ticketlist[p].tpaytype+"';<\/script></td></td><td><input type='text' class='tickfield' disabled='disabled' onkeypress='setTicketDirtyFlag();' name='input_box_two[]' value='"+ticketlist[p].tqty+"'/></td><td><input type='text' class='tickfield' disabled='disabled' id='three' name='input_box_three[]' onkeypress='setTicketDirtyFlag();' value='"+ticketlist[p].tprice+"'/></td><td style='text-align:center;'><a style='cursor:pointer'  onClick=showticketforevent("+ticketlist[p].trowid+",'ticket1','dynamictickets','false')><div id='nwmoreinfodiv' style='margin-right:32%;'><img src={!URLFOR($Resource.createevents,'createevents/images/editevent1.png')} width='25px' height='25px'/></div></a></td> <td><input type='button' class='del' value='' /></td></tr>";  
      else
      {
      var inntext='';
        for(var sub=0,inntext='';sub<ticketlist[p].subpackagegroup.length;sub++)
             if(ticketlist[p].subpackagegroup[sub].pkgitemname!=''&&ticketlist[p].subpackagegroup[sub].pkgitemname!=undefined)
             inntext=inntext+'['+ticketlist[p].subpackagegroup[sub].pkgitemname+' : '+ticketlist[p].subpackagegroup[sub].pkgitemqty+'] ';
             
      appendTxt += "<tr><td><img src='{!$Resource.DragButton}'  style='margin-left:-5px;margin-right:5px;'/><input type='text' id='one' class='tickfield' name='input_box_one[]' onkeypress='setTicketDirtyFlag();' disabled='disabled' value='"+ticketlist[p].tname+"'><div>"+inntext+"</div></td> <td><SELECT disabled='disabled' onchange='setTicketDirtyFlag();' class=' selectlist ' NAME=\"Animal\" id='ppptype"+apvar+"'><apex:repeat value="{!paymentSelectOptions}" var="paytype"><option value='{!paytype.value}'>{!paytype.label}</option></apex:repeat></SELECT><script>document.getElementById('ppptype"+apvar+"').value='"+ticketlist[p].tpaytype+"';<\/script></td></td><td><input type='text' class='tickfield' disabled='disabled' onkeypress='setTicketDirtyFlag();' name='input_box_two[]' value='"+ticketlist[p].tqty+"'/></td><td><input type='text' disabled='disabled' class='tickfield' id='three' name='input_box_three[]' onkeypress='setTicketDirtyFlag();' value='"+ticketlist[p].tprice+"'/></td><td style='text-align:center;'><a style='cursor:pointer'  onClick=Alert3.render(this.parentNode.parentNode.rowIndex,this.parentNode.parentNode.children[0].children[1].value,this.parentNode.parentNode.children[1].children[0].value,this.parentNode.parentNode.children[2].children[0].value,this.parentNode.parentNode.children[3].children[0].value)><div id='nwmoreinfodiv' style='margin-right:32%;'><img src={!URLFOR($Resource.createevents,'createevents/images/editevent1.png')} width='25px' height='25px'/></div></a></td> <td><input type='button' class='del' value='' /></td></tr>";  
      }
       
        //alert(ticketlist[p].ticketcount);
         apvar=apvar+1;
        
      }
    }
    
     $(".dynamic").find("tr:gt(0)").remove();
      $(".dynamic tbody").append(appendTxt); 
      var tableappend2=document.getElementById("tickettable");
                    var tableDnD2 = new TableDnD();

                    tableDnD2.init(tableappend2);
    }
    // m=setInterval('saveTicketSate()', 1 * 1000);
   }
   function saveTicketSate()
   {
 
   var tableappend2=document.getElementById("tickettable");
                    var tableDnD2 = new TableDnD();

                    tableDnD2.init(tableappend2);
   
         //create session for tickets
        var table = document.getElementById("tickettable");
             for (var i = 1, row,arrindex=0; row = table.rows[i]; i++) {
              if(row.style.display!='none'){
             col = row.cells[0];
             ticketlist[arrindex].tname=col.children[1].value;
             //for showing package information 
               if(ticketlist[arrindex].ispackage=="true"){
             var cacheDiv = document.createElement('div');
             for(var sub=0,inntext='';sub<ticketlist[arrindex].subpackagegroup.length;sub++)
             if(ticketlist[arrindex].subpackagegroup[sub].pkgitemname!=''&&ticketlist[arrindex].subpackagegroup[sub].pkgitemname!=undefined)
             inntext=inntext+'['+ticketlist[arrindex].subpackagegroup[sub].pkgitemname+' : '+ticketlist[arrindex].subpackagegroup[sub].pkgitemqty+'] ';
             else
             ticketlist[arrindex].subpackagegroup.splice(sub,1);
               cacheDiv.innerHTML = inntext;
               try{
               col.children[2].innerHTML=inntext;
               }catch(e){col.appendChild(cacheDiv);}
               }
             col = row.cells[1];
             ticketlist[arrindex].tpaytype=col.children[0].value;
             col = row.cells[2];
             ticketlist[arrindex].tqty=col.children[0].value;
             col = row.cells[3];
             //for showing help text for donation
               var cacheImage = document.createElement('img');
               cacheImage.src = '/s.gif';
               cacheImage.className= 'helpIcon';
               ;
               if(ticketlist[arrindex].tpaytype=='Donation'){
               col.children[0].style.width="60%";
               if(col.children[0].value=="")
               col.children[0].value="0";
               cacheImage.alt='Enter Minimum Donation Amount';
               cacheImage.title='Enter Minimum Donation Amount';
               try{
               console.log(col.children[1].value);
               }catch(e){col.appendChild(cacheImage);}
               }
               else if(ticketlist[arrindex].tpaytype=='Paid' && Number(col.children[0].value)==0)
               {
                  col.children[0].value="";
                  col.children[0].style.width="60%";
                  cacheImage.alt='Price cannot be left blank or 0 for Paid Ticket';
               cacheImage.title='Price cannot be left blank or 0 for Paid Ticket';
                   try{
               console.log(col.children[1].value);
               }catch(e){col.appendChild(cacheImage);}
               }
               else
               {
                   try{
                        col.removeChild(col.children[1]);
                        }catch(e){}
               }
               
             ticketlist[arrindex].tprice=col.children[0].value;
             if(ticketlist[arrindex].tpaytype=='Free'){
             if(ticketlist[arrindex].tprice!='Group Tickets')
             col.children[0].value=0;
             col.children[0].disabled="disabled";
             }
             else
             col.children[0].disabled=false;
             ticketlist[arrindex].trowid=col.parentNode.rowIndex;
             if(ticketlist[arrindex].grouptickets.length==1){
             ticketlist[arrindex].grouptickets[0].tname=ticketlist[arrindex].tname;
             ticketlist[arrindex].grouptickets[0].qty=ticketlist[arrindex].tqty;
             ticketlist[arrindex].grouptickets[0].tprice=ticketlist[arrindex].tprice;
             }
             
           
             
             if(ticketlist[arrindex].grouptickets.length==0){
             ticketlist[arrindex].tvisib='Public';
             if(ticketlist[arrindex].ispackage=="true")
             ticketlist[arrindex].itemtype=$("#pkitemtype option:first").val();
             else{
             if(ticketlist[arrindex].itemtype==''||ticketlist[arrindex].itemtype==undefined)
             ticketlist[arrindex].itemtype=$("#itemtype option:first").val();
            
             
             }
             
             }
             
             arrindex++;
             }
           
             }
             
            //console.log(ticketlist);
             sessionStorage['ticket']=JSON.stringify(ticketlist);
           
       
   }
   
   
    var ticketclick=false;
    var totcountinner;
   function saveTicket()
   {
           
        if(document.getElementById('ospbc').checked==true&&(document.getElementById('chqaddr1').value==''||document.getElementById('chqZip').value==''||document.getElementById('chqcountry').value=='None'||document.getElementById('chqstate').value==''||document.getElementById('chqcity').value==''))
        {
        //alert('Please enter the mandatory fields for check address');
        AlertNew.render('Please enter the mandatory fields for check address','Alert!','ok');
        document.getElementById("ticketloader").style.display="none";
        return;}
        if(document.getElementById('chqZip').value!='')
        {
            var country = jQuery('#chqcountry :selected').text();
            var val = document.getElementById('chqZip').value;
            var len = val.length;
            if(country == 'India')
            {
                if(len<6 || len>6){                
                    //alert('ZipCode should contains 6 digits');
                    AlertNew.render('ZipCode should contains 6 digits' ,'Alert!','ok');
                    try{ticketclick=false;document.getElementById("ticketloader").style.display="none" }catch(e){}
                    return false;
                }
            }
            if(country == 'United States Of America')
            {
                if(len<5 || len>5){
                    //alert('ZipCode should contains 5 digits');
                    AlertNew.render('ZipCode should contains 5 digits' ,'Alert!','ok');
                    try{ticketclick=false;document.getElementById("ticketloader").style.display="none" }catch(e){}
                    return false;
                }
            }
        }


   var paidflag=0;
   var ticketlimit='{!defaultnooftickets}';
    var totcountqty=0;
   totcountinner=0;
   for(tkind=0;tkind<ticketlist.length;tkind++)
   {
        if(ticketlist[tkind].tpaytype=="Paid"){
       paidflag=1;

       }
       totcountqty=totcountqty+Number(ticketlist[tkind].tqty);
       totcountinner=totcountinner+Number(ticketlist[tkind].tqty);
       for(var tkindj=0;tkindj<ticketlist[tkind].subpackagegroup.length;tkindj++)
           {
            
           totcountinner=totcountinner+(Number(ticketlist[tkind].subpackagegroup[tkindj].pkgitemqty)*Number(ticketlist[tkind].tqty));             
            
           }
       
   }
  
   if(totcountinner>ticketlimit){
       //alert('Max ticket limit reached, Please call Eventdex support');
       AlertNew.render('Max ticket limit reached, Please call Eventdex support','Alert!','ok');
       document.getElementById("ticketloader").style.display="none";
       return;
       }
        
      
  if(paidflag==1)
      {
      paidflag=0;
      ShowLoader();
      
      Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.paymentsetornot}',
            eventmand.EventID, 
            function(result, event){
            HideLoader();
            if(result=='no')
            {
              Alertconfirm.render('Please select Payment Gateways' , 'Confirmation',this,'Now','Later','Alertconfirm');
              
            }
            else
            {
              //for free ticket only ticket save
  if(ticketclick==true)
  return;
  if(ticketclick==false)
  ticketclick=true;
      saveOnlyTicket();
            }
            
            });
      } 
      else
      {        
      
  
  //for free ticket only ticket save
  if(ticketclick==true)
  return;
  if(ticketclick==false)
  ticketclick=true;
      saveOnlyTicket();
      
   }     
       
        
        }
        
    function callback(clkbtn){
    if(clkbtn.id==undefined){
    document.getElementById("ticketloader").style.display="none";  
    Alert_paymentopt.render('dialogbox_paymentopt','paymentopt_dialogoverlay','Alert_paymentopt' ,this);HideLoader();
    }
    else
    {
     $('input[name="payradio"][value="Free"]').attr("checked",true);
     $('input[name="payradio"][value="Free"]').attr("disabled",true);
     $('input[name="payradio"][value="Paid"]').attr("disabled",true);
     $('input[name="payradio"][value="Donation"]').attr("disabled",true);
             $('#tvisib').val("Private");
             document.getElementById("tvisib").disabled="disabled";
              document.getElementById("itemtype").disabled="disabled";
             document.getElementById("tickettype").disabled="disabled";
             document.getElementById("ticketqty").disabled="disabled";
             var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       row.cells[3].children[0].value=1;
       row.cells[3].children[0].disabled="disabled";
       row.cells[4].children[0].value=0;
       row.cells[5].children[0].value=1;
       
      }
    }
    }
/*************Call back for cancel**********************/   
function callbackcancel(clkbtn){
    if(clkbtn.id==undefined){
   //for free ticket only ticket save
  if(ticketclick==true)
  return;
  if(ticketclick==false)
  ticketclick=true;
      saveOnlyTicket();
  }
  else
  $('input[name="ticketedsession"][value="true"]').attr("checked",true);
   
    
    }     
   function saveOnlyTicket()
   {
  console.log(ticketlist[parentrowindex-1]);
   var datetime =new Date().today()+" " + new Date().timeNow();
    Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.savesTicketInfo}',
            '['+JSON.stringify(ticketlist[parentrowindex-1])+']',
            eventmand.EventID,
            datetime,
            defaultendtime,
            totcountinner,
            function(result, event){
            if (event.status){
            if(result==''){
            //sucess code
            
           ticketlist=[]; 
           for(var loopi=0;loopi<60;loopi++)
{
ticketlist.push({poolid:"",tname:"",tpaytype:"",tqty:"",tprice:"",tvisib:"",tdesc:"",ticketedsession:"",tcketlogo:"",tbdglabel:"",tbadgable:"",trowid:"",grouptickets:[],ticketcount:"",tags:[],subpackagegroup:[],ispackage:"",itemtype:"",taxrateflag:"",tebudprcflag:""});
}
            mask1();
             showclose('package1','dynamictickets');
            showclose('ticket1','dynamictickets');try{document.getElementById('ticketpagepaymentoption').style.display='block';document.getElementById('ticketpagesavebutton').style.display='block';}catch(e){}
            }
            else
            {
           //alert(result);
            AlertNew.render(result,'Alert!','ok');
             ticketclick=false; 
            }
            document.getElementById("ticketloader").style.display="none";
           
             } 
             else if (event.type === 'exception') {
                    //alert(event.message + " " + event.where + " ");
                    AlertNew.render(event.message + " " + event.where + " ",'Alert!','ok');
                    document.getElementById("ticketloader").style.display="none";
                     ticketclick=false; 
                } else {
                    //alert(event.message);
                    AlertNew.render(event.message,'Alert!','ok');
                    document.getElementById("ticketloader").style.display="none";
                     ticketclick=false; 
                }  
               
                try{
                releaseTicketDirtyFlag(); 
                }catch(e){}               
            }, 
            {escape: true}
        );
   }     
  

</script>
            


<apex:form >
      <apex:actionfunction name="savePackageLogo" action="{!saveEventLogo}" status="AjaxLoader" rerender="reRenderedPanelToSetPackageVariable" oncomplete="savepackageinfo();document.getElementById('ticketloader').style.display='none';">
      <apex:param name="imageData" value="" assignTo="{!imageData}"/>
 <apex:param name="IsUploadEventLogo" value="" assignTo="{!IsUploadEventLogo}"/>
</apex:actionfunction></apex:form>
<apex:outputPanel id="reRenderedPanelToSetPackageVariable">
   <script type="text/javascript">
      packagelogourl= "{!eventlogourl}";
      
   </script>
</apex:outputPanel>
      <!---script for on click  close during package  div --->
                 <script>
                 
function showclose(show,hide)
{
document.getElementById(show).style.display="none";
document.getElementById(hide).style.display="block";
lineitemaddcount=0;
try{document.getElementById('ticketsavebutton').style.display="";}catch(e){}
}
var pckcontents='';
var packagelogourl='';
                     function checkpackagelogo()
                     {
                          
                             var oFReader = new FileReader();
                     var f = document.getElementById("pklogo").files[0];
          

           if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
      pckcontents= e.target.result.split(',')[1];
 IsUploadEventLogo = true;  
                 
      }
      r.readAsDataURL(f);
     
    } else { 
      //alert("Failed to load file");
      AlertNew.render('Failed to load file' ,'Alert!','ok');
    }
    
                     }

function savepackageinfo()
{
if(deladdonid.length!=0){
var deleteflag=0;
           for(var np=0;np<ticketlist[parentrowindex-1].ticketcount;np++)
           {
               if(ticketlist[parentrowindex-1].grouptickets[np].availabletickets!=Number(ticketlist[parentrowindex-1].grouptickets[np].qty)){
               deleteflag=1;
               break;
               }
           }
           if(deleteflag==1){
           //alert('Can not delete Ticket, Package or Line Item when you already have sold items!');
           AlertNew.render('Can not delete Ticket, Package or Line Item when you already have sold items!','Alert!','ok');
            deladdonid='';
     addonrowindex='';
           return;
           
           }
           }
           
  //for knowing sold items for inner loop

           
           
           
           
 deladdonid=deladdonid.slice(0,-1);
    addonrowindex=addonrowindex.slice(0,-1);
    
     var araddonrowindex = [];
     araddonrowindex = addonrowindex.split(",");
     if(addonrowindex.length!=0){
     for (var araddonrowindexi= 0; araddonrowindexi< araddonrowindex.length; araddonrowindexi++) {
    
    ticketlist[parentrowindex-1].subpackagegroup.splice(araddonrowindex[araddonrowindexi],1);
       }
       try{ShowLoader();}catch(e){}
       Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.deleteaddonItemPool}',
            deladdonid,
           function(result, event){
           try{
           HideLoader();
           }catch(e){}
           savepackagerest();
           });}
           else
           savepackagerest();
     
     
}


function savepackagerest()
{
deladdonid='';
     addonrowindex='';


   
      var rowindex;
      if(isnewpackage=="true")
      {
        rowindex=document.getElementById("tickettable").rows.length-1;
       }
        else
       rowindex=parentrowindex-1;
       
       ticketlist[rowindex].trowid=rowindex+1;
       ticketlist[rowindex].ispackage="true";
       parentrowindex=rowindex+1;
       
       //store the package items/subgroup
       //if(ticketlist[rowindex].subpackagegroup.length==0)
       //ticketlist[rowindex].subpackagegroup=[];
       var alsold=0;
if(isnewpackage!="true"){
for(var np=0;np<ticketlist[parentrowindex-1].ticketcount;np++)
           {
               if(ticketlist[parentrowindex-1].grouptickets[np].availabletickets!=Number(ticketlist[parentrowindex-1].grouptickets[np].qty)){
               alsold=1;
               break;
               }
           }}
       var table = document.getElementById("packagetable");
       for (var i = 1, row,nhiderow=0; row = table.rows[i]; i++) {
       
        if(row.style.display!='none'){
        
              if(ticketlist[rowindex].subpackagegroup[nhiderow]==undefined)
              ticketlist[rowindex].subpackagegroup.push({addonid:"",pkgitemname:"",pkgitemqty:"",ttype:"",badgelabel:"",badgable:"",tags:[]});
              ticketlist[rowindex].subpackagegroup[nhiderow].pkgitemname=row.cells[0].children[0].value;
              try{
              if(alsold==1&&isnewpackage!="true"&&ticketlist[rowindex].subpackagegroup[nhiderow].pkgitemqty!=row.cells[1].children[0].value)
           alert('The change to this package will only apply to the future users.');
           }catch(e){}
             ticketlist[rowindex].subpackagegroup[nhiderow].pkgitemqty=row.cells[1].children[0].value;
             try{
             if(alsold==1&&isnewpackage!="true"&&ticketlist[rowindex].subpackagegroup[nhiderow].ttype!=row.cells[2].children[0].value&&ticketlist[rowindex].subpackagegroup[nhiderow].ttype!=""&&ticketlist[rowindex].subpackagegroup[nhiderow].addonid!="")
             {
             var origtype=$("#ttypeindex0").find("option[value='"+ticketlist[rowindex].subpackagegroup[nhiderow].ttype+"']").text();
              var convertype=$("#ttypeindex0").find("option[value='"+row.cells[2].children[0].value+"']").text();
              if(origtype=='Lead Retrieval'||origtype=='MatchLeads Buyer'||origtype=='MatchLeads Seller'||origtype=='Scan Attendee'||convertype=='Lead Retrieval'||convertype=='MatchLeads Buyer'||convertype=='MatchLeads Seller'||convertype=='Scan Attendee')
                          {            
              alert('Sold ticket type cannot be changed for Eventdex Product');
              row.cells[2].children[0].value=ticketlist[rowindex].subpackagegroup[nhiderow].ttype;
              row.cells[5].children[0].value=ticketlist[rowindex].subpackagegroup[nhiderow].badgelabel;
              if(ticketlist[rowindex].subpackagegroup[nhiderow].badgable=='B - Badge')
             row.cells[4].children[0].checked=true;
             else
             row.cells[4].children[0].checked=false;
             return;
              }
              
              else
           {
              ticketlist[rowindex].subpackagegroup[nhiderow].ttype=row.cells[2].children[0].value;
              ticketlist[rowindex].subpackagegroup[nhiderow].badgelabel=row.cells[5].children[0].value;
              if(row.cells[4].children[0].checked==true)
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='B - Badge';
             else
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='N - No Badge';
              }
           }
           else
           {
              ticketlist[rowindex].subpackagegroup[nhiderow].ttype=row.cells[2].children[0].value;
              ticketlist[rowindex].subpackagegroup[nhiderow].badgelabel=row.cells[5].children[0].value;
              if(row.cells[4].children[0].checked==true)
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='B - Badge';
             else
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='N - No Badge';
              }
              }catch(e){
              ticketlist[rowindex].subpackagegroup[nhiderow].ttype=row.cells[2].children[0].value;
              ticketlist[rowindex].subpackagegroup[nhiderow].badgelabel=row.cells[5].children[0].value;
              if(row.cells[4].children[0].checked==true)
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='B - Badge';
             else
             ticketlist[rowindex].subpackagegroup[nhiderow].badgable='N - No Badge';
              }
              //add tags at package item level
              ticketlist[rowindex].subpackagegroup[nhiderow].tags=[];
              var testimonialElements = $(".resultspl");
              var tsps=LineItemTagMap [nhiderow+1];
         if(tsps!=undefined){
         tsps=tsps.split(";");
         
          for(var l=0;l<tsps.length;l++)
          {
            ticketlist[rowindex].subpackagegroup[nhiderow].tags.push({tagname:""});
            ticketlist[rowindex].subpackagegroup[nhiderow].tags[l].tagname=tsps[l];
          }
          }
              //
              
              /*Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            ticketlist[rowindex].subpackagegroup[nhiderow].ttype,
            nhiderow,
           function(result, event){
            ticketlist[rowindex].subpackagegroup[result.arrindex].badgable=result.badgable;
         
             });*/
             
              nhiderow++;
         }
       }
       
       //
      
       //store the package more ingo group
       if(ticketlist[rowindex].grouptickets.length==0)
        ticketlist[rowindex].grouptickets=[];
       var table = document.getElementById("packagemoreinfotable");
       for (var i = 1, row,nhiderow=0; row = table.rows[i]; i++) {
       
        if(row.style.display!='none'){
              if(ticketlist[rowindex].grouptickets[nhiderow]==undefined)
              ticketlist[rowindex].grouptickets.push({itemid:"",tname:"",sdate:"",edate:"",qty:"",minqty:"",maxqty:"",tprice:"",availabletickets:""});
              ticketlist[rowindex].grouptickets[nhiderow].tname=row.cells[0].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].sdate=row.cells[1].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].edate=row.cells[2].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].qty=row.cells[3].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].minqty=row.cells[4].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].maxqty=row.cells[5].children[0].value;
              ticketlist[rowindex].grouptickets[nhiderow].tprice=row.cells[6].children[0].value;
              
              nhiderow++;
         }
       }
       //
              ticketlist[rowindex].itemtype=document.getElementById('pkitemtype').value;
              ticketlist[rowindex].tpaytype=document.querySelector('input[name="pkgpayradio"]:checked').value;
              ticketlist[rowindex].tvisib=$('#pkvisib').val();
              ticketlist[rowindex].tebudprcflag=$('#pebudprcflag').attr('checked');
              ticketlist[rowindex].taxrateflag=$('#ptaxrate').attr('checked');
              if(ticketlist[rowindex].grouptickets.length==1){
                             
                             ticketlist[rowindex].tebudprcflag=true;
                             }
              ticketlist[rowindex].tdesc=$( "#pkdesc" ).parent().children().eq(0).children().eq(0).children().eq(2).children().eq(0).contents().find('body').html();
              ticketlist[rowindex].tbadgable='N - No Badge';
              Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            ticketlist[rowindex].itemtype,
            rowindex,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                                ticketlist[result.arrindex].tbdglabel="";
                                
                             }
                           else{
                           
                             ticketlist[result.arrindex].tbdglabel=result.badgelabel;
                             
                         }
             });
              //Adding PackageLogo
          
  if(packagelogourl!=''){
  ticketlist[rowindex].tcketlogo=packagelogourl;
  pckcontents='';
  }
  else{
  if(IsUploadEventLogo){
  ticketlist[rowindex].tcketlogo=null;
  }
  }
   //set the tags array to null
                                   
                                  ticketlist[rowindex].tags=[];


//code for adding tags
                             var testimonialElements = $(".resultspk");
                             
                             for(var f=0,tgindex=0; f<testimonialElements.length; f++){
                                  
                                  var element = testimonialElements.eq(f);
                                  if(element[0].children[0].children[0].children[0].children[0].checked){
                                  ticketlist[rowindex].tags.push({tagname:""});
                                  //store eventtag id
                                  ticketlist[rowindex].tags[tgindex].tagname=getKeyByValue(TagMap,element[0].children[0].children[0].children[1].innerHTML);
                                  tgindex++;
                                  }
                                  }
                             //end of tags
                             //
       //
       ticketlist[rowindex].ticketcount=nhiderow;
       //
        if(isnewpackage=="false")
        {
              ticketlist[rowindex].tname=document.getElementById('packagename').value;
              ticketlist[rowindex].tqty=document.getElementById('packageqty').value;
               ticketlist[rowindex].tprice=document.getElementById('packageprice').value;
                ticketlist[rowindex].tpaytype=document.getElementById('packagetype').value;
                if(ticketlist[rowindex].grouptickets.length==1){
                ticketlist[rowindex].grouptickets[0].qty=ticketlist[rowindex].tqty;
                ticketlist[rowindex].grouptickets[0].tprice=ticketlist[rowindex].tprice;
                ticketlist[rowindex].grouptickets[0].tname=ticketlist[rowindex].tname;
                }
        }
      else{ 
/*var appendTxt = "<tr><td><img src='{!$Resource.DragButton}'  style='margin-left:-5px;margin-right:5px;'/><input type='text' id='one' class='tickfield' name='input_box_one[]' value='"+document.getElementById('packagename').value+"'></td> <td><SELECT id='ppptype"+rowindex+"' class='selectlist' NAME=\"Animal\"><apex:repeat value="{!paymentSelectOptions}" var="paytype"><option value='{!paytype.value}'>{!paytype.label}</option></apex:repeat></SELECT><script>document.getElementById('ppptype"+rowindex+"').value='"+ticketlist[rowindex].tpaytype+"';<\/script></td></td><td><input type='text' class='tickfield' name='input_box_two[]' value='"+document.getElementById('packageqty').value+"'/></td><td><input type='text' class='tickfield' id='three' name='input_box_three[]' value='"+document.getElementById('packageprice').value+"' /></td><td style='text-align:center;'><a onClick=Alert3.render(this.parentNode.parentNode.rowIndex,this.parentNode.parentNode.children[0].children[1].value,this.parentNode.parentNode.children[1].children[0].value,this.parentNode.parentNode.children[2].children[0].value,this.parentNode.parentNode.children[3].children[0].value)><div id='nwmoreinfodiv' style='margin-right:32%;'><img src={!URLFOR($Resource.createevents,'createevents/images/addmore.png')} width='25px' height='25px'/></div></a></td> <td><input type='button' class='del' value='' /></td></tr>";
      $(".dynamic tbody").append(appendTxt); 
      var tableappend=document.getElementById("tickettable");
                    var tableDnD1 = new TableDnD();
                    tableDnD1.init(tableappend);*/
                     ticketlist[rowindex].tname=document.getElementById('packagename').value;
              ticketlist[rowindex].tqty=document.getElementById('packageqty').value;
               ticketlist[rowindex].tprice=document.getElementById('packageprice').value;
                ticketlist[rowindex].tpaytype=document.getElementById('packagetype').value;
      if(ticketlist[rowindex].grouptickets.length==1){
                ticketlist[rowindex].grouptickets[0].qty=ticketlist[rowindex].tqty;
                ticketlist[rowindex].grouptickets[0].tprice=ticketlist[rowindex].tprice;
                ticketlist[rowindex].grouptickets[0].tname=ticketlist[rowindex].tname;
                }
      if(ticketlist[0].trowid=='')
      {
         ticketlist.splice(0, 1);
         ticketlist.push({poolid:"",tname:"",tpaytype:"",tqty:"",tprice:"",tvisib:"",tdesc:"",ticketedsession:"",tcketlogo:"",tbdglabel:"",tbadgable:"",trowid:"",grouptickets:[],ticketcount:"",tags:[],subpackagegroup:[],ispackage:"",itemtype:"",taxrateflag:"",tebudprcflag:""});
            
      }
      }
      
     
          var npflag=0;
           for(var np=0;np<ticketlist[rowindex].ticketcount;np++)
           {
               if(ticketlist[rowindex].grouptickets[np].availabletickets!=0){
               npflag=1;
               break;
               }
           }
           if(npflag==0&&isnewpackage!="true"&&ticketlist[rowindex].poolid!=''&&lineitemaddcount==1)
           //alert('There are no package available while adding the line items');
           AlertNew.render('There are no package available while adding the line items' ,'Alert!','ok');
      
       lineitemaddcount=0;

console.log(ticketlist);
ticketvalid();
}
     </script>         
     
     <!--------------------end of script-------------->    
          
    <!-----------------------start of ticket row validation---------------------------------------------------------------------->
  <c:ed_commonstyles ></c:ed_commonstyles>
    <c:ed_popupbox ></c:ed_popupbox>  
<script>

function ticketvalid(){

  
var s='';
var eventstatus = '{!isEventCompleted}';
if(eventstatus == 'true'){
        //alert('Event has completed, You cannot modify the event!');
        AlertNew.render('Event has completed, You cannot modify the event!','Alert!','ok');
        s='error';
        }
     
if(ticketlist[parentrowindex-1].ispackage!="true"){
if (document.getElementById("ticketname").value==""){
document.getElementById("ticketname").style.border="2px solid #d43535";
s='error';
}

if (document.getElementById("ticketprice").value==""){
document.getElementById("ticketprice").style.border="2px solid #d43535";
s='error';
}

if (document.getElementById("ticketqty").value==""){

document.getElementById("ticketqty").style.border="2px solid #d43535";
s='error';
}

<!------------------success------------------------>

if (document.getElementById("ticketname").value!=""){
document.getElementById("ticketname").style.border="1px solid #e3e3e3";
}

if (document.getElementById("ticketprice").value!=""){
document.getElementById("ticketprice").style.border="1px solid #e3e3e3";
}

if (document.getElementById("ticketqty").value!=""){

document.getElementById("ticketqty").style.border="1px solid #e3e3e3";
}

if (document.getElementById("ticketqty").value!="" && document.getElementById("ticketqty").value <= 0){
s='error';
document.getElementById("ticketqty").style.border="2px solid #d43535";
alert('Ticket Qty cannot be less than or equal to zero');
}

if (document.getElementById("ticketprice").value!="" && document.getElementById("ticketprice").value < 0){
s='error';
document.getElementById("ticketprice").style.border="2px solid #d43535";
alert('Ticket Price cannot be less than zero');
}
if(pgtexcep)
{
//alert('Please save the key');
AlertNew.render('Please save the key' ,'Alert!','ok');
s='error';
}
try{
if(s!='error'){
ticketlist[parentrowindex-1].tname=document.getElementById("ticketname").value;

ticketlist[parentrowindex-1].tqty=document.getElementById("ticketqty").value;
ticketlist[parentrowindex-1].tprice=document.getElementById("ticketprice").value;
if(ticketlist[parentrowindex-1].grouptickets.length==1){
ticketlist[parentrowindex-1].grouptickets[0].tprice=document.getElementById("ticketprice").value;
ticketlist[parentrowindex-1].grouptickets[0].qty=document.getElementById("ticketqty").value;
ticketlist[parentrowindex-1].grouptickets[0].tname=document.getElementById("ticketname").value;
}
ticketlist[parentrowindex-1].tpaytype=document.getElementById("tickettype").value;
if(ticketlist[parentrowindex-1].ticketedsession==="")
ticketlist[parentrowindex-1].ticketedsession="true";
}

}catch(e){}
}
try{
if(ticketlist[parentrowindex-1].tpaytype=='Paid'&&ticketlist[parentrowindex-1].tprice==0)
{
 AlertNew.render('Price cannot be 0 for paid type tickets/package' ,'Alert!','ok');
 s='error';
}
}catch(e){}
if(s!='error')
{
/alert("success");/
document.getElementById("ticketloader").style.display="";

saveTicket();

}


}



</script>

<!-------------------------------package section validation------------------------------------------------>
<script>

<!----------------pkgname onblur valid---------------------------->
function pkgnmblurvalid(){
if (document.getElementById("packagename").value== ""){
document.getElementById("packagename").style.border="2px solid #d43535";

}
if (document.getElementById("packagename").value!= "")
{
document.getElementById("packagename").style.border="2px solid #bac958";
}
}

<!-----------------------pkgname onKeyup valid----------------------------------------->
function pkgnmkeyupvalid(){
document.getElementById("packagename").style.border="1px solid #e3e3e3";
}

<!--------------------------------------------------------------------------------->

<!----------------pkgprice onblur valid---------------------------->
function pkgpriceblurvalid(){
if (document.getElementById("packageprice").value== ""){
document.getElementById("packageprice").style.border="2px solid #d43535";

}
if (document.getElementById("packageprice").value!= "")
{
document.getElementById("packageprice").style.border="2px solid #bac958";
}
}

<!-----------------------pkgprice onKeyup valid----------------------------------------->
function pkgpricekeyupvalid(){
document.getElementById("packageprice").style.border="1px solid #e3e3e3";
}

<!--------------------------------------------------------------------------------->

<!----------------pkgqty onblur valid---------------------------->
function pkgqtyblurvalid(){
if (document.getElementById("packageqty").value== ""){
document.getElementById("packageqty").style.border="2px solid #d43535";

}
if (document.getElementById("packageqty").value!= "")
{
document.getElementById("packageqty").style.border="2px solid #bac958";
}
}

<!-----------------------pkgqty onKeyup valid----------------------------------------->
function pkgqtykeyupvalid(){
document.getElementById("packageqty").style.border="1px solid #e3e3e3";
}

<!--------------------------------------------------------------------------------->

<!------------on click of package save valid--------------------------------------------------------------------------->
function pkgvalid(){
var s='';
<!--------------------------------error--------------------------------->
if (document.getElementById("packagename").value==""){
document.getElementById("packagename").style.border="2px solid #d43535";
}

if (document.getElementById("packageprice").value==""){
document.getElementById("packageprice").style.border="2px solid #d43535";
}

if (document.getElementById("packageqty").value==""){

document.getElementById("packageqty").style.border="2px solid #d43535";
}

<!------------------success------------------------>

if (document.getElementById("packagename").value!=""){
document.getElementById("packagename").style.border="1px solid #e3e3e3";
}

if (document.getElementById("packageprice").value!=""){
document.getElementById("packageprice").style.border="1px solid #e3e3e3";
}

if (document.getElementById("packageqty").value!=""){

document.getElementById("packageqty").style.border="1px solid #e3e3e3";
}

if (document.getElementById("packageqty").value!="" && document.getElementById("packageqty").value <= 0){
s='error';
document.getElementById("packageqty").style.border="2px solid #d43535";
alert('Package Qty cannot be less than or equal to zero');
}

if (document.getElementById("packageprice").value!="" && document.getElementById("packageprice").value < 0){
s='error';
document.getElementById("packageprice").style.border="2px solid #d43535";
alert('Package Price cannot be less than zero');
}

<!-------------------------------Pkg line item validation---------------------------------------------->

var pkgitm= document.getElementsByClassName("pkglineitmfield");
var pkgitmlen=pkgitm.length;

var k = 0;
for (var i=0; i<pkgitmlen; i++){
k++;
if (pkgitm[i].value.trim()==""){

pkgitm[i].style.border="2px solid #d43535"
s='error';
}
else if(pkgitm[i].value.trim()!=""){

pkgitm[i].style.border="1px solid #e3e3e3"

}
if(k==2){
if(pkgitm[i].value.trim()!=="" && pkgitm[i].value.trim() <=0){
pkgitm[i].style.border="2px solid #d43535"
s='error';
alert('Item Qty cannot be less than or equal to zero');
}
k =0;
}
}

if(document.getElementById('packagetable').rows.length<=1)
{
AlertNew.render('Package should have at least one Line Item','Alert!','ok');
s='error';
}

if(s!='error' && document.getElementById("packagename").value != "" && document.getElementById("packageprice").value != "" && document.getElementById("packageqty").value != "" )
{


if(pckcontents=='')
{
 savepackageinfo();
 
 packagelogourl='';
}
else{
savePackageLogo(pckcontents, IsUploadEventLogo);
document.getElementById("ticketloader").style.display="";
}
//savePackageLogo(pckcontents, IsUploadEventLogo);
//document.getElementById("ticketloader").style.display="";
 //$('#ticketloader').hide();
//showclose('package1','dynamictickets');
try{
//document.getElementById('ticketpagepaymentoption').style.display="block";
//document.getElementById('ticketpagesavebutton').style.display="block";
}catch(e){}
setTicketDirtyFlag();
}


<!------------------------------------------------------------------------------------------------------>

}

</script>
<!------------------------------------------------------------------------------------------------------->
<!-----------------------------------end of ticket row validation------------------------------------------------------------------------------------->
 
<!-------css for dynamic table-------------------->
     
    
 <style>
 input:disabled {
    background:#dddddd;
}
select:disabled {
    background: #dddddd;
}
select optgroup{
background:#EFEFEF;
color:#438ac2;
font-style:normal;
font-weight:normal;
padding:3px 0px;
margin:3px 0px;
}

.selectoption option{
background:#fff;
color:#000;
font-style:normal;
font-weight:normal;

}
</style>

          <style type="text/css">
        .del{ 
background-image:url({!URLFOR($Resource.createevents,'createevents/images/removerow.png')} ); background-repeat:no-repeat; background-position:center; width:30px; height:30px;
          background-color: #DDD; border-radius:3px; cursor:pointer;margin-left:35%;}
        
        
        #three{width:65.5%;}    
        #one{width:87.5%;}   
    
    .del1{background-image:url({!URLFOR($Resource.createevents,'createevents/images/removerow.png')} ); background-repeat:no-repeat; background-position:center;width:30px; height:30px;
          background-color: #DDD; border-radius:3px; cursor:pointer;margin-left:35%;}
        
         
          .del2{background-image:url({!URLFOR($Resource.createevents,'createevents/images/removerow.png')} ); background-repeat:no-repeat; background-position:center; width:30px; height:30px;
          background-color: #DDD; border-radius:3px; cursor:pointer;margin-left:35%;}
        
        
        .del3{background-image:url({!URLFOR($Resource.createevents,'createevents/images/removerow.png')} ); background-repeat:no-repeat; background-position:center; width:30px; height:30px;
          background-color: #DDD; border-radius:3px; cursor:pointer;margin-left:35%;}
        
        .add,.add1,.add2,.add3{
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(253,253,253,1)), color-stop(100%,rgba(227,227,227,1)));
background: -webkit-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -moz-gradient(linear, left top, left bottom, color-stop(0%,rgba(253,253,253,1)), color-stop(100%,rgba(227,227,227,1)));
background: -moz-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -o-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -ms-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fdfdfd', endColorstr='#e3e3e3',GradientType=0 );
border: 1px solid #e3e3e3;
float:left;
text-decoration:none;

border-radius: 3px;
/* padding-top: 5px; */
padding-left:0px;
padding: 5px 5px 2px 5px;
margin-right:10%;
cursor:pointer;  
              }
    
        </style>
    
<!--popup script for manage tags-->
<script type="text/javascript">
function getKeyByValue(object,value ) {
    for( var prop in object) {
        if( object.hasOwnProperty( prop ) ) {
             if( object[ prop ] === value )
                 return prop;
        }
    }
}

function CustomAlert(){
    this.render =function(dialog){
    
    //code for adding existing event tags
   
   
                    var appendTxt = '';
                    
                    for(var key in TagMap) {

                    appendTxt+='<tr><td width="85%">'+TagMap[key]+'</td><td><img src=" {!URLFOR($Resource.createevents,'createevents/images/delete1.png')}" class="btnExcluir" style="margin-right:20%;"/><img src="{!URLFOR($Resource.createevents,'createevents/images/pencil.png')}" width="20" height="20" class="btnEditar"/></td></tr>';
                    }
                     
                      $("#managetagpopup").find("tr:gt(0)").remove();
                     $("#managetagpopup tbody").append(appendTxt);
                      $(function(){
     var oldtagtext=''
      
    function Editar(){
    
        var par = $(this).parent().parent(); //tr
        var tdNome = par.children("td:nth-child(1)");
        oldtagtext=tdNome.html();
   
        var tdBotoes = par.children("td:nth-child(2)");

        tdNome.html("<input type='text' id='txtNome' value='"+tdNome.html()+"'/>");
       

        tdBotoes.html("<img src={!URLFOR($Resource.createevents,'createevents/images/disk.png')} class='btnSalvar'/>");

        $(".btnSalvar").unbind("click").bind("click", Salvar);
        //$(".btnEditar").bind("click", Editar);
        //$(".btnExcluir").bind("click", Excluir);
        
    };

    function Salvar(){
  
        var par = $(this).parent().parent(); //tr
        var tdNome = par.children("td:nth-child(1)");
        
        var tdBotoes = par.children("td:nth-child(2)");

        tdNome.html(tdNome.children("input[type=text]").val());
       
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.updateEventTag}',
            eventmand.EventID,
            oldtagtext,
            tdNome.html(),
           function(result, event){
           if (event.status){
           TagMap[result]=tdNome.html();
           console.log(TagMap);
           }}
           );
    
        tdBotoes.html("<img src={!URLFOR($Resource.createevents,'createevents/images/delete1.png')} class='btnExcluir' style='margin-right:20%;'/><img src={!URLFOR($Resource.createevents,'createevents/images/pencil.png')} class='btnEditar'/>");

        $(".btnEditar").unbind("click").bind("click", Editar);
        //$(".btnEditar").bind("click", Editar);
        //$(".btnExcluir").bind("click", Excluir);
         $(".btnExcluir").unbind("click").bind("click", Excluir);
    };

    function Excluir(){
        var par = $(this).parent().parent(); //tr
         var tdNome = par.children("td:nth-child(1)");
          var keys=getKeyByValue(TagMap,tdNome.html());
           delete TagMap[keys];
          Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.deleteEventTag}',
            eventmand.EventID,
            tdNome.html(),
           function(result, event){
           if (event.status){
          
           console.log(TagMap);
           }}
           );
        par.remove();
    };

     $(".btnEditar").bind("click", Editar);
    $(".btnExcluir").bind("click", Excluir);
    //$("#btnAdicionar").bind("click", Adicionar);           

});
           
          
    
    //
    
    
        var winW = window.innerWidth;
        var winH = window.innerHeight;
        var dialogoverlay =document.getElementById('dialogoverlay');
        var dialogbox = document.getElementById('dialogbox');
        dialogoverlay.style.display="block";
        /*dialogoverlay.style.height = winH +"px";
        dialogbox.style.left=(winW/2) -(905*.5)+"px";*/
        dialogbox.style.top="80px";
        dialogbox.style.display="block";
        
    }
    this.Cancel = function(){
        document.getElementById('dialogbox').style.display ="none";
                document.getElementById('dialogoverlay').style.display ="none";
          //get saved tags
          
                    var appendTxt = '';
                     $('.results').remove(); 
                     $('.resultspk').remove(); 
                     $('.resultspl').remove(); 
                   for(var key in TagMap) {
                    $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+TagMap[key]+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#abcpk').append('<table class="resultspk">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+TagMap[key]+'</td>'
                            
                           +'</tr>'
                       + '</table>'); 
                       $('#abcpkitems').append('<table class="resultspl">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+TagMap[key]+'</td>'
                            
                           +'</tr>'
                       + '</table>');  
                     }
                     $('#addtextlabel').val(''); //clearing textbox value
                     $('#addtextlabelpk').val(''); //clearing textbox value
                     $('#addtextlabelpkitems').val('');
                     
                if(ticketlist[parentrowindex-1].ispackage=="true"){
            //prepopulate tags
        
        
        for(var k=0;k<ticketlist[parentrowindex-1].tags.length;k++)
           {
               var testimonialElements = $(".resultspk");
                             for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                  if(TagMap[ticketlist[parentrowindex-1].tags[k].tagname]==element[0].children[0].children[0].children[1].innerHTML)
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
             
           }
        //end of prepopulate tags
        }
        else{
        for(var k=0;k<ticketlist[parentrowindex-1].tags.length;k++)
           {
               var testimonialElements = $(".results");
                             for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                  if(TagMap[ticketlist[parentrowindex-1].tags[k].tagname]==element[0].children[0].children[0].children[1].innerHTML)
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
             
           }
           
         
        //end of prepopulate tags
        }
        
          try{
          var testimonialElements = $(".resultspl");
         var tsps=LineItemTagMap [pklinerowindex];
         if(tsps!=undefined){
         tsps=tsps.split(";");
         
          for(var l=0;l<tsps.length;l++)
          {
            
             
                             for(var k=0; k<testimonialElements.length; k++){
                            
                                  var element = testimonialElements.eq(k);
                                  if(tsps[l]==getKeyByValue(TagMap ,element[0].children[0].children[0].children[1].innerHTML))
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
          }
          }
           }
           catch(e){}
                return false;
        
        }
    
    }
    
    var AlertMT = new CustomAlert(); 

</script>
<!-----------------------popupscript for ticket moreinfo-------------------------------->
<script type="text/javascript">
var parentrowindex;
 var flag;
 var earlybudname,earlybudqty,earlybudprice;
 var isnewpackage;
 </script>
<script>
 function renderpackagebadge()
 {
     var ptable = document.getElementById("packagetable");
       for (var l = 1,row; row = ptable.rows[l]; l++) {
       Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            row.cells[2].children[0].options[row.cells[2].children[0].selectedIndex].value,
            l,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                                ptable.rows[result.arrindex].cells[4].children[0].checked=false;
                                ptable.rows[result.arrindex].cells[5].children[0].disabled="disabled";
                             }
                           else{
                           
                             ptable.rows[result.arrindex].cells[4].children[0].checked=true;
                             ptable.rows[result.arrindex].cells[5].children[0].disabled=false;
                         }
             });
      
    
       }
 }
    </script>
 <apex:outputpanel id="ticketmoreinfoblock">
<script type="text/javascript">
function CustomAlert(){
    this.render =function(rowindex,tname,tpaytype,tqty,tprice){
    parentrowindex=rowindex;
     try{document.getElementById('ticketsavebutton').style.display="none";}catch(e){}
    for(var i=0;i<ticketlist.length;i++)
    {
       if(ticketlist[i].trowid==parentrowindex)
       {
          if(ticketlist[i].ispackage=="true"){
          renderpackage(i,tname,tqty,tprice,ticketlist[i].tpaytype);
          
          }
          else
          renderticket(i,tname,tpaytype,tqty,tprice);
       }
    }      
    
  }  
    
  
    this.Cancel = function(){
        document.getElementById('dialogbox3').style.display ="none";
                document.getElementById('dialogoverlay2').style.display ="none";
            
                
                return false;
        
        }
    
    }
    
    var Alert3 = new CustomAlert(); 
    function renderpackage(i,tname,tqty,tprice,tpaytype)
    {
    
    
    flag=-1;
   
       showpackageforevent('package1','dynamictickets','false');
       document.getElementById('packagename').value=tname;
       document.getElementById('pminfoname').value=tname;
       document.getElementById('packageqty').value=tqty;
       document.getElementById('packageprice').value=tprice;
       document.getElementById('packagetype').value=tpaytype;
      
       var appendTxt='';
       try{
       
       $('#pkvisib').val(ticketlist[i].tvisib);
       $('#pebudprcflag').attr('checked',ticketlist[i].tebudprcflag);
       $('#ptaxrate').attr('checked',ticketlist[i].taxrateflag);
$( "#pkdesc" ).parent().children().eq(0).children().eq(0).children().eq(2).children().eq(0).contents().find('body').html(ticketlist[i].tdesc);
$('input[name="pkgpayradio"][value="' + ticketlist[i].tpaytype+ '"]').attr("checked",true);}catch(e){}

       for(var j=0;j<ticketlist[i].ticketcount;j++)
           {
            
           var mypck = ['dummy','estart2pck','estart3pck','elate1pck','elate2pck','dummy1']; 
          appendTxt += "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(ticketlist[i].grouptickets[j].tname)+"'/></td> <td><input type='text' id="+mypck[j]+" style='width:75%' class='datetimepickers' value='"+ticketlist[i].grouptickets[j].sdate+"'/></td><td><input type='text' id="+mypck[j+3]+" style='width:75%' class='datetimepickers'  value='"+ticketlist[i].grouptickets[j].edate+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].qty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].minqty+"'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+ticketlist[i].grouptickets[j].maxqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].tprice+"'/></td></tr>";
    
          flag=0;
        if(ticketlist[i].tcketlogo != '' && ticketlist[i].tcketlogo != null){
        
         var imgurl = "/servlet/servlet.FileDownload?file="+ticketlist[i].tcketlogo;
            $('#savedpackageimage img').attr('src',imgurl);
            

           }
           }
      $(".dynamic4").find("tr:gt(0)").remove();
      $(".dynamic4 tbody").append(appendTxt);
      try{
        document.getElementById('elate1pck').onchange=function(){document.getElementById('estart2pck').value=document.getElementById('elate1pck').value};
        document.getElementById('estart2pck').onchange=function(){document.getElementById('elate1pck').value=document.getElementById('estart2pck').value};
        document.getElementById('elate2pck').onchange=function(){document.getElementById('estart3pck').value=document.getElementById('elate2pck').value};
        document.getElementById('estart3pck').onchange=function(){document.getElementById('elate2pck').value=document.getElementById('estart3pck').value};
      }catch(e){}
        flag=ticketlist[i].ticketcount-1; 
       
        //show early bird price checkbox or not
         if(ticketlist[i].grouptickets.length>1)
        document.getElementById("earlybirdpackkpric").style.display="";
        else
        document.getElementById("earlybirdpackkpric").style.display="none";
        
        //prepopulate tags
        
        
        for(var k=0;k<ticketlist[i].tags.length;k++)
           {
               var testimonialElements = $(".resultspk");
                             for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                  if(TagMap[ticketlist[i].tags[k].tagname]==element[0].children[0].children[0].children[1].innerHTML)
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
             
           }
        //end of prepopulate tags
        
        
        
        
        var pmtable = document.getElementById("packagemoreinfotable");
       for (var k = 1,row; row = pmtable.rows[k]; k++) {
       row.cells[0].children[0].value=unescape(row.cells[0].children[0].value);
       if(document.querySelector('input[name="pkgpayradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
       row.cells[6].children[0].disabled=false;
       }
       }
        
        appendTxt='';
        
       
        for(var j=0;j<ticketlist[i].subpackagegroup.length;j++)
           {
             var checked='';
             var disabled='';
            if(ticketlist[i].subpackagegroup[j].badgable=='B - Badge')
            checked='checked';
            if(ticketlist[i].subpackagegroup[j].badgable=='N - No Badge')
            disabled='disabled';
            
           appendTxt += "<tr><td><input type='text' id='one' class='pkglineitmfield' name='input_box_one[]' value='"+escape(ticketlist[i].subpackagegroup[j].pkgitemname)+"'/></td> <td><input type='text' class='pkglineitmfield' id='three' name='input_box_three[]' value='"+ticketlist[i].subpackagegroup[j].pkgitemqty+"'/></td><td><select class='selectlist'  style='outline:none;' onchange='checkbadgelabeledit(this);' id='ttypeindex"+j+"' ><optgroup label='Tickets'><apex:repeat value="{!individualTicketsSelectOptions}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup><optgroup label='Eventdex Products'><apex:repeat value="{!BLPRODTicketsSelectOptions}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup><optgroup label='Add On Items'><apex:repeat value="{!itemtypesaddon}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup></select></td><td><div id='pkgtagsdiv' onclick='Alert6.render(this.parentNode.parentNode.rowIndex)'><img src={!URLFOR($Resource.createevents,'createevents/images/addtags.png')} width='25px' height='25px'></div></td><td><input type='checkbox'  onchange='enablepkitembadgelabel(this);' style='width: 85%;' "+checked+"/></td><td><input type='text'  style='width: 85%;' value='"+ticketlist[i].subpackagegroup[j].badgelabel+"' "+disabled+"/></td><td><input type='button' class='del1' value='' /></td></tr>";             
            
           try{
                var pli=''
                for(var l=0;l<ticketlist[i].subpackagegroup[j].tags.length;l++)
                {
                  
                   pli=pli+ticketlist[i].subpackagegroup[j].tags[l].tagname+';';   
                }
                pli=pli.replace(/;(\s+)?$/, '');
                LineItemTagMap[j+1]=pli;
                
           }catch(e){}
           
           }
           
           $(".dynamic2").find("tr:gt(0)").remove();
      $(".dynamic2 tbody").append(appendTxt);
      
      showttype(i);
      
      var ptable = document.getElementById("packagetable");
       for (var l = 1,row; row = ptable.rows[l]; l++) {
       row.cells[0].children[0].value=unescape(row.cells[0].children[0].value);
       
       
       
       
       
      
       }
       
       //renderpackagebadge();
       
    }
    function showttype(i)
    {
        
          
        for(var j=0;j<ticketlist[i].subpackagegroup.length;j++)
           { 
              document.getElementById('ttypeindex'+j).value=ticketlist[i].subpackagegroup[j].ttype;
           }
             
    }
    
   function renderticket(i,tname,tpaytype,tqty,tprice)
   {
  
    //LOGIC FOR RENDERING TICKETS FROM TICKETLIST
    earlybudname=tname;
    earlybudqty=tqty;
    earlybudprice=tprice;
   
    var appendTxt='';
    flag=-1;
    document.getElementById('ticketedsessiondiv').style.display='none';
     //clear all checkbox in tags
      var testimonialElements = $(".results");
      for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                  element[0].children[0].children[0].children[0].children[0].checked=false;
                                  }
   
          
           for(var j=0;j<ticketlist[i].ticketcount;j++)
           {
             var myids = ['dummy','estart2','estart3','elate1','elate2','dummy1']; 
             appendTxt =appendTxt + "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(ticketlist[i].grouptickets[j].tname)+"'/></td><td>  <input type='text' id= "+myids[j]+" style='width:75%' class='datetimepickers' value='"+ticketlist[i].grouptickets[j].sdate+"'/></td><td><input type='text' id= "+myids[j+3]+" style='width:75%' class='datetimepickers' value='"+ticketlist[i].grouptickets[j].edate+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].qty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].minqty+"' /></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].maxqty+"' /></td><td><input type='text' id='three' name='input_box_three[]' value='"+ticketlist[i].grouptickets[j].tprice+"' /></td><td id='regticket' style='display:none;'><input type='button' class='del2' title='Delete Ticket' value='' /></td></tr>";
            if(ticketlist[i].tcketlogo != null && ticketlist[i].tcketlogo != ''){
            var imgurl = "/servlet/servlet.FileDownload?file="+ticketlist[i].tcketlogo;
            $('#savedticketimage img').attr('src',imgurl); 
          
           }
           else
           $('#savedticketimage img').attr('src',''); 
           }
      $(".dynamic3").find("tr:gt(0)").remove();
      $(".dynamic3 tbody").append(appendTxt);
      try{
      document.getElementById('elate1').onchange=function(){document.getElementById('estart2').value=document.getElementById('elate1').value;};
      document.getElementById('estart2').onchange=function(){document.getElementById('elate1').value=document.getElementById('estart2').value};
      document.getElementById('elate2').onchange=function(){document.getElementById('estart3').value=document.getElementById('elate2').value};
      document.getElementById('estart3').onchange=function(){document.getElementById('elate2').value=document.getElementById('estart3').value};
      }catch(e){}
        flag=ticketlist[i].ticketcount-1; 
        
        
        //show early bird price checkbox or not
         if(ticketlist[i].grouptickets.length>1)
        document.getElementById("earlybirdtickpric").style.display="";
        else
        document.getElementById("earlybirdtickpric").style.display="none";
        
        
        //prepopulate tags
        
        
        for(var k=0;k<ticketlist[i].tags.length;k++)
           {
               var testimonialElements = $(".results");
                             for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                  if(TagMap[ticketlist[i].tags[k].tagname]==element[0].children[0].children[0].children[1].innerHTML)
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
             
           }
        //end of prepopulate tags
        
     
   
    if(flag==-1){
    $('#savedticketimage img').attr('src',''); 
   var datetime =new Date().today()+" " + new Date().timeNow();
   var currentmaxqty='{!itemdefaultmaxqty}'>Number(tqty)?tqty:'{!itemdefaultmaxqty}';
    appendTxt = "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(tname)+"'/></td><td>  <input type='text' class='datetimepickers' style='width:75%' value='"+datetime+"'/></td><td><input type='text' style='width:75%' class='datetimepickers' value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+tqty+"' /></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}' /></td><td><input type='text' id='three' name='input_box_three[]' value='"+currentmaxqty+"' /></td><td><input type='text' id='three' name='input_box_three[]' value='"+tprice+"' /></td><td id='regticket' style='display:none;'><input type='button' class='del2' title='Delete Ticket' value='' /></td></tr>";
      $(".dynamic3").find("tr:gt(0)").remove();
      $(".dynamic3 tbody").append(appendTxt);
     
      }
     //special character checking
      var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
       row.cells[0].children[0].value=unescape(row.cells[0].children[0].value);
       if(tpaytype=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else
       {
       row.cells[6].children[0].disabled=false;
       }
       
       }
       
      $('input[name="payradio"][value="' + tpaytype+ '"]').attr("checked",true);
      document.getElementById('tminfoname').value=tname;
    // $( "#tdesc" ).parent().children().eq(1).contents().find('body').html($('<textarea />').html(ticketlist[i].tdesc).text());
    $( "#tdesc" ).parent().children().eq(0).children().eq(0).children().eq(2).children().eq(0).contents().find('body').html($('<textarea />').html(ticketlist[i].tdesc).text());
       document.getElementById('tbdglabel').value=ticketlist[i].tbdglabel;
       if(ticketlist[i].tbadgable=='N - No Badge'){
       document.getElementById('tbdgable').checked=false;
       document.getElementById('tbdglabel').disabled=true;
       }
       else
       {
       document.getElementById('tbdgable').checked=true;
       document.getElementById('tbdglabel').disabled=false;
       }
       $('#tvisib').val(ticketlist[i].tvisib);
       $('#ttaxrate').attr('checked',ticketlist[i].taxrateflag);
       $('#ebudprcflag').attr('checked',ticketlist[i].tebudprcflag);
       document.getElementById('itemtype').value=ticketlist[i].itemtype;
       try{
       //editticketbadgelabelmoreinfo(document.getElementById('itemtype').value);
       }catch(e){
       //alert(e);
       AlertNew.render(e,'Alert!','ok');
       }
      
       //END OF LOGIC FOR RENDERING TICKETS FROM TICKETLIST
        var winW = window.innerWidth;
        var winH = window.innerHeight;
        var dialogoverlay =document.getElementById('dialogoverlay2');
        var dialogbox = document.getElementById('dialogbox3');
        dialogoverlay.style.display="block";
        /*dialogoverlay.style.height = winH +"px";
        dialogbox.style.left=(winW/2) -(905*.5)+"px";*/
        dialogbox.style.top="10px";
        dialogbox.style.display="block";
        try{
        if($("#itemtype").find("option:selected").text()=='Seminars'&&document.querySelector('input[name="payradio"]:checked').value=='Free')
        {
            document.getElementById('ticketedsessiondiv').style.display='';
             $('input[name="ticketedsession"][value="'+ticketlist[i].ticketedsession+'"]').attr("checked",true);
             }
             if((ticketlist[i].ticketedsession=="false"||ticketlist[i].ticketedsession===false)&&$("#itemtype").find("option:selected").text()=='Seminars')
             {
             hideallsession();
             }
             else{
             unhideallsession();
             }
             
             }catch(e){}
        
        
    } 
    

    
   Date.prototype.today = function () { 
    return (((this.getMonth()+1) < 10)?"0":"")+(this.getMonth()+1)+"/"  + ((this.getDate() < 10)?"0":"") + this.getDate() +"/"+ this.getFullYear();
} 
  Date.prototype.timeNow = function(){     return ((this.getHours() < 10)?"0":"") + ((this.getHours()>12)?(this.getHours()-12):this.getHours()) +":"+ ((this.getMinutes() < 10)?"0":"") + this.getMinutes() +" "+ ((this.getHours()>12)?('PM'):'AM'); };
     
   

</script>
<!------------------------------------------------------------------------------------->
</apex:outputpanel>
<!------------------------------------------------------------------------------------->


<!-----------------------popupscript for package moreinfo -------------------------------->
<script type="text/javascript">
var mrclick;
function CustomAlert(){
    this.render =function(pname,pprice,pqty,ptype){
  
  $('input[name="pkgpayradio"][value="' + ptype+ '"]').attr("checked",true);
  
               var pmtable = document.getElementById("packagemoreinfotable");
               if(pmtable.rows.length==2){
       for (var i = 1,row; row = pmtable.rows[i]; i++) {
       row.cells[0].children[0].value=pname;
       row.cells[3].children[0].value=pqty;
       row.cells[6].children[0].value=pprice;
       validfreepack();
       }
       }
              
       earlybudname=pname;
       earlybudqty=pqty;
       earlybudprice=pprice;
      if(flag==-1)
      {
        if(mrclick==0){
        var datetime =new Date().today()+" " + new Date().timeNow();
        var currentmaxqty='{!itemdefaultmaxqty}'>Number(pqty)?pqty:'{!itemdefaultmaxqty}';
     var appendTxt= "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(pname)+"'/></td> <td><input type='text' style='width:75%' class='datetimepickers' value='"+datetime+"'/></td><td><input type='text' style='width:75%' class='datetimepickers'  value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+pqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+currentmaxqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+pprice+"'/></td></tr>";
      $(".dynamic4").find("tr:gt(0)").remove();
      $(".dynamic4 tbody").append(appendTxt);
      mrclick++;
      //special character
       var pmtable = document.getElementById("packagemoreinfotable");
       for (var i = 1,row; row = pmtable.rows[i]; i++) {
       row.cells[0].children[0].value=unescape(row.cells[0].children[0].value);
        if(document.querySelector('input[name="pkgpayradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
       row.cells[6].children[0].disabled=false;
       }
       }
      }
      <!--added by unni---->
     else{
     var datetime =new Date().today()+" " + new Date().timeNow();
        var currentmaxqty='{!itemdefaultmaxqty}'>Number(pqty)?pqty:'{!itemdefaultmaxqty}';
     var appendTxt= "<tr><td><input type='text' id='one' name='input_box_one[]' value='"+escape(pname)+"'/></td> <td><input type='text' style='width:75%' class='datetimepickers' value='"+datetime+"'/></td><td><input type='text' style='width:75%' class='datetimepickers'  value='"+defaultendtime+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+pqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='{!itemdefaultminqty}'/></td><td><input type='text' id='three' name='input_box_three[]'  value='"+currentmaxqty+"'/></td><td><input type='text' id='three' name='input_box_three[]' value='"+pprice+"'/></td></tr>";
        
     $(".dynamic4").find("tr:gt(0)").remove();
      $(".dynamic4 tbody").append(appendTxt);
      mrclick++;
      //special character
       var pmtable = document.getElementById("packagemoreinfotable");
       for (var i = 1,row; row = pmtable.rows[i]; i++) {
       row.cells[0].children[0].value=unescape(row.cells[0].children[0].value);
        if(document.querySelector('input[name="pkgpayradio"]:checked').value=='Free'){
       row.cells[6].children[0].value=0;
       row.cells[6].children[0].disabled="disabled";
       }
       else{
      
       row.cells[6].children[0].disabled=false;
       }
       }
          
      
      }
      <!-----end of unni add----->
      }
       document.getElementById('pminfoname').value=pname;
        var winW = window.innerWidth;
        var winH = window.innerHeight;
        var dialogoverlay =document.getElementById('dialogoverlay2');
        var dialogbox = document.getElementById('dialogbox4');
        dialogoverlay.style.display="block";
        
        dialogbox.style.top="10px";
        dialogbox.style.display="block";
        
    }
    this.Cancel = function(){
        document.getElementById('dialogbox4').style.display ="none";
                document.getElementById('dialogoverlay2').style.display ="none";
            
                
                return false;
        
        }
    
    }
    
    var Alert4= new CustomAlert();  
//call when you click create/edit ticket
function showticketforevent(temprowid,show,hide,blnewticket)
{
unhideallsession();
document.getElementById("tickettype").value='Paid';
checkfree(document.getElementById('tickettype').value);

try{document.getElementById('ticketsavebutton').style.display="none";}catch(e){}
if(blnewticket=='true')
{
document.getElementById('ticketprice').disabled=false;
//for new ticket
document.getElementById('ticketname').value='';
document.getElementById('ticketprice').value='';
document.getElementById('ticketqty').value='';


 ticketlist[document.getElementById("tickettable").rows.length-1].itemtype=$("#itemtype option:first").val();
 ticketlist[document.getElementById("tickettable").rows.length-1].trowid=document.getElementById("tickettable").rows.length;
     parentrowindex=document.getElementById("tickettable").rows.length;
   
Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            $("#itemtype option:first").val(),
            document.getElementById("tickettable").rows.length-1,
           function(result, event){
           ticketlist[result.arrindex].tbadgable=result.badgable;
           
           if(result.badgable!='B - Badge')
                            {
                                ticketlist[result.arrindex].tbdglabel="";
                                
                             }
                           else{
                           
                             ticketlist[result.arrindex].tbdglabel=result.badgelabel;
                             
                         }
             }); 

   }
   else
   {
   
   parentrowindex=temprowid;
   document.getElementById('itemtype').value=ticketlist[parentrowindex-1].itemtype;
   if((ticketlist[parentrowindex-1].ticketedsession=="false"||ticketlist[parentrowindex-1].ticketedsession===false)&&$("#itemtype").find("option:selected").text()=='Seminars')
             hideallsession();
             else
             unhideallsession();
   document.getElementById('ticketname').value=ticketlist[parentrowindex-1].tname;
document.getElementById('ticketprice').value=ticketlist[parentrowindex-1].tprice;
document.getElementById('ticketqty').value=ticketlist[parentrowindex-1].tqty;
document.getElementById('tickettype').value=ticketlist[parentrowindex-1].tpaytype;
checkfree(document.getElementById('tickettype').value);
   }
   document.getElementById(show).style.display="block";
document.getElementById(hide).style.display="none";
document.getElementById('package1').style.display="none";
}
</script>
 <!---script for show package div --->
                 <apex:outputpanel id="showpackageblock">
                 <script>
                 
 
                
                 
function showpackageforevent(show,hide,blnewpack)
{
try{document.getElementById('ticketsavebutton').style.display="none";}catch(e){}
document.getElementById("packagetype").value="Paid";
checkfreepackage(document.getElementById('packagetype').value);
//for new package
document.getElementById('packagename').value='';
document.getElementById('packageprice').value='';
document.getElementById('packageqty').value='';
 mrclick=0;
var appendTxt='';
for(var j=1;j<2;j++)
           {
           appendTxt += "<tr><td><input type='text' id='one' class='pkglineitmfield' name='input_box_one[]'/></td> <td><input type='text' class='pkglineitmfield' id='three' name='input_box_three[]' /></td><td><select class='selectlist'  style='outline:none;' onchange='checkbadgelabeledit(this);'><optgroup label='Tickets'><apex:repeat value="{!individualTicketsSelectOptions}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup><optgroup label='Eventdex Products'><apex:repeat value="{!BLPRODTicketsSelectOptions}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup><optgroup label='Add On Items'><apex:repeat value="{!itemtypesaddon}" var="indittype"><option value='{!indittype.value}'>{!indittype.label}</option></apex:repeat></optgroup></select></td><td><div id='pkgtagsdiv' onclick='Alert6.render(this.parentNode.parentNode.rowIndex)'><img src={!URLFOR($Resource.createevents,'createevents/images/addtags.png')} width='25px' height='25px'></div></td><td><input type='checkbox' checked=true onchange='enablepkitembadgelabel(this);'   style='width: 85%;'/></td><td><input type='text' id='one'   name='input_box_one[]' style='width: 85%;'/></td><td><input type='button' class='del1' value='' /></td></tr>";             
           }
           $(".dynamic2").find("tr:gt(0)").remove();
      $(".dynamic2 tbody").append(appendTxt);
      //removing rows from packageinfo table if those are already filled up as this is a new one
      $(".dynamic4").find("tr:gt(0)").remove();
//
flag=-1;
$('#savedpackageimage img').attr('src','');
isnewpackage=blnewpack;
document.getElementById(show).style.display="block";
document.getElementById(hide).style.display="none";
document.getElementById('ticket1').style.display="none";
if(isnewpackage=="true"){
$('input[name="pkgpayradio"][value="Paid"]').attr("checked",true);
$('#pkvisib').val('Public');
$( "#pkdesc" ).parent().children().eq(0).children().eq(0).children().eq(2).children().eq(0).contents().find('body').html('');
getlabelbadgeout();
$('#ptaxrate').attr('checked',false);
}

try{
//document.getElementById('ticketpagepaymentoption').style.display="none";
//document.getElementById('ticketpagesavebutton').style.display="none";
}catch(e){}
}


     </script>   
    </apex:outputpanel>  
     <script>
    function getlabelbadgeout()
    {
       var table = document.getElementById("packagetable");
             var row = table.rows[1];


Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            row.cells[2].children[0].value,
            1,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                                row.cells[5].children[0].value="";
                                row.cells[5].children[0].disabled="disabled";
                                row.cells[4].children[0].checked=false;
                             }
                           else{
                             row.cells[5].children[0].disabled=false;
                             row.cells[5].children[0].value=result.badgelabel;
                             row.cells[4].children[0].checked=true;
                         }
             });
    }
    function checkbadgelabeledit(badgelabelcombo)
{
var table = document.getElementById("packagetable");
var row = table.rows[$(badgelabelcombo).parent().parent().index()+1];


Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.getbadgeinfo}',
            badgelabelcombo.options[badgelabelcombo.selectedIndex].value,
            1,
           function(result, event){
           
           
           if(result.badgable!='B - Badge')
                            {
                                row.cells[5].children[0].value="";
                                row.cells[5].children[0].disabled="disabled";
                                row.cells[4].children[0].checked=false;
                             }
                           else{
                             row.cells[5].children[0].disabled=false;
                             row.cells[5].children[0].value=result.badgelabel;
                             row.cells[4].children[0].checked=true;
                         }
             });



}
   function enablepkitembadgelabel(badgablecheckbox)
{

var table = document.getElementById("packagetable");
var row = table.rows[$(badgablecheckbox).parent().parent().index()+1];
if(row.cells[4].children[0].checked==false)
{
row.cells[5].children[0].value="";
 row.cells[5].children[0].disabled="disabled";
 }
 else
row.cells[5].children[0].disabled=false;




}
    </script>    
             
<c:ticketdragdrop />


<!---------------------------------------------------------------->
<style>

#dialogoverlay2{
    display:none;
    opacity: .8;
position: fixed;
top: 0px;
left: 0px;
background-color: #484848;
width: 100%;
z-index:99;
height: 100%;
    
    }

  #dialogbox6{ display:none; position:fixed;padding:5px;;
 width:40%; margin-left:29%; z-index:100;padding-bottom:30px;  overflow:auto; border-radius:3px;
  -webkit-border-radius: 3px;-moz-border-radius: 3px;}


 #pkgtagsdiv{
background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(253,253,253,1)), color-stop(100%,rgba(227,227,227,1)));
background: -webkit-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -o-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: -ms-linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
background: linear-gradient(top, rgba(253,253,253,1) 0%,rgba(227,227,227,1) 100%);
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fdfdfd', endColorstr='#e3e3e3',GradientType=0 );
border: 1px solid #e3e3e3;
padding: 5px;
padding-bottom:1px;
border-radius: 3px;
/* padding-top: 5px; */
padding-left:6px;
float: right;
margin-right:30%;
cursor:pointer;
}


</style>

<!--------------------------------------------------------------------------->
<!-----------------------popupscript for tags for package line items -------------------------------->
<script type="text/javascript">
var LineItemTagMap = {}; 
var pklinerowindex;
function CustomAlert(){
    this.render =function(plrowindex){
        pklinerowindex=plrowindex;
        var testimonialElements = $(".resultspl");
        for(var l=0; l<testimonialElements.length; l++){
                            
                                  var element = testimonialElements.eq(l);
                                    element[0].children[0].children[0].children[0].children[0].checked=false;
                                  
                                  }
         var tsps=LineItemTagMap [pklinerowindex];
         if(tsps!=undefined){
         tsps=tsps.split(";");
         
          for(var l=0;l<tsps.length;l++)
          {
            
             
                             for(var k=0; k<testimonialElements.length; k++){
                            
                                  var element = testimonialElements.eq(k);
                                  if(tsps[l]==getKeyByValue(TagMap ,element[0].children[0].children[0].children[1].innerHTML))
                                  element[0].children[0].children[0].children[0].children[0].checked=true;
                                  
                                  }
          }
          }
          
               
         
        
        
        var winW = window.innerWidth;
        var winH = window.innerHeight;
        var dialogoverlay =document.getElementById('dialogoverlay2');
        var dialogbox = document.getElementById('dialogbox6');
        dialogoverlay.style.display="block";
        
        dialogbox.style.top="100px";
        dialogbox.style.display="block";
        
    }
    this.Cancel = function(){
        document.getElementById('dialogbox6').style.display ="none";
                document.getElementById('dialogoverlay2').style.display ="none";
          
          var tsp='';
          var testimonialElements = $(".resultspl");
                             
                             for(var f=0; f<testimonialElements.length; f++){
                                  
                                  var element = testimonialElements.eq(f);
                                  if(element[0].children[0].children[0].children[0].children[0].checked){
                                  tsp=tsp+getKeyByValue(TagMap,element[0].children[0].children[0].children[1].innerHTML)+';';
                                  
                                  }
                                  }
                                  
          tsp=tsp.replace(/;(\s+)?$/, ''); 
         
          LineItemTagMap[pklinerowindex]=tsp;
          
          
          
         
            
                
                return false;
        
        }
    
    }
    
    var Alert6= new CustomAlert();  

</script>
<!------------------------>
<!--------close of script---------------> 
                    <script type="text/javascript">//<![CDATA[ 
$(window).load(function(){
$(function() {
   $('#btn_spkitems').click(function(e) {
     e.preventDefault();
     var name  = $('input[name="addtagtextpkitems"]').val()
if(name !==''){
        
          Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.createEventTag}',
            eventmand.EventID,
            name,
           function(result, event){
            if (event.status){
            if(result!=''){
       $('#abcpk').append('<table class="resultspk">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpk').val(''); //clearing textbox value
                     $('#abc').append('<table class="results">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabel').val(''); //clearing textbox value
                    
                    $('#abcpkitems').append('<table class="resultspl">'
                         +'<tr>' 
                          +'<td>'+'<input type="checkbox" />'+'</td>'
                            +'<td>'+name+'</td>'
                            
                           +'</tr>'
                       + '</table>');
                       
                    $('#addtextlabelpkitems').val(''); //clearing textbox value
                     TagMap[result] = name;
                    console.log(TagMap);
                    }
                    else
                    {
                       //alert('Duplicate value');
                       AlertNew.render('Duplicate value' ,'Alert!','ok');
                    }
            }
           });

 
    }
   }
    );
    $('#btn_i').click(function() {
      $('.results').remove();  
    });
});
});//]]>  


 function addtagsshowpkitems(){
     document.getElementById("addtagtextpkitems").style.display="";
     document.getElementById("addtagsshowpkitems").style.display="none";
     
     }
     function setTicketDirtyFlag()
{
ticketneedToConfirm= true; //Call this function if some changes is made to the web page and requires an alert
// Of-course you could call this is Keypress event of a text box or so...
}

function releaseTicketDirtyFlag()
{
ticketneedToConfirm= false; //Call this function if dosent requires an alert.
//this could be called when save button is clicked 
}
var ticketneedToConfirm=false;


//Logo Validation



</script>
                    <!------------------------->

<!---------------------------------------popup for packagelineitems tag-------------->        
     <div id="dialogoverlay2"></div>
<!--close of dialogoverlay2-->
<div id="dialogbox6"><a id="close" onclick="Alert6.Cancel()" style="color: white;">×</a>
<div class="grid-1" style=" width:98%;margin-left:1%; padding-right:0px;">
    <div class="title-grid">Add Tags</div>
    <div class="content-gird" >
    <!---------------------------------------------------->
    <div id="addtagsdivpkitems" style="">
          <div id="abcpkitems" style="width:100%;">


</div>

  <!--------------------------------------->
  <div style="display:block; border-top: 1px #E5E5E5 solid;border-bottom: 1px #E5E5E5 solid; background-color:#F7F7F7; text-align:center;font-size:18px; font-family:cuprum; color:#5283cc;">
    <div id="addtagsshowpkitems" onClick="addtagsshowpkitems()" style="padding:5px;" >
     <span style="margin-right:0%;"><img src="{!URLFOR($Resource.createevents,'createevents/images/addtag.png')}" width="18px" height="18px" style="margin-right:2%; margin-bottom:-3px;"/>Add Tags</span>
    </div>
    <table id="addtagtextpkitems" border="0" width="95%" style="margin:0px auto; margin-top:5px; margin-bottom:5px; display:none;">
    <tbody>
        <tr>
      <!--<td style="text-align:left">Tag Name</td>-->
      <td><input id="addtextlabelpkitems" type="text" name="addtagtextpkitems" placeholder="" style="width:80%;"/></td>
      <td>
       <div class="buttonHolder">   
    <input class="button-a blue"  type="button" name="submit" value="Save" onclick="" id="btn_spkitems"/>
    <!--<input class="button-a blue"  value="clear" type="button" id="btn_i">--> 
  </div></td>
      <!--<td><input type="checkbox" name="check"></td>-->
    
    </tr>
    
  </tbody></table>
  </div>
 
 
             <!-------------------------------------------------------->
          </div><!--close of addtagsdiv-->
           
           <div id="managetagbtn" onclick="AlertMT.render()"  style="width:100%; cursor:pointer; text-align:center; background-color:#F7F7F7; padding:5px 0px; font-size:18px; font-family:cuprum; color:#5283cc;">
           
           <img src="{!URLFOR($Resource.createevents,'createevents/images/manage.png')}" width="20px" height="20px" style="margin-right:2%; margin-bottom:-3px;"/>Manage Tags
           
           </div><!--close of managetagbutton-->
          
          <!--------------------------------------------------------------------->
         
    
    <!------------------------------------------------------->
    
    
    </div><!--close of content-grid-->
    </div><!--close of grid-1-->
    </div><!--close of dialogbox6-->
   
    <!----------------close of popup for packagelineitems tag-------------------->
    <apex:form id="counter">
       <script>
       function showrefreshitem()
       {
       try{
        for(var j=0;j<ticketlist.length;j++)
           {
           
           if(ticketlist[j].trowid!=''){
           for(iindex=0;iindex<ticketlist[j].ticketcount;iindex++)
           {
               <apex:repeat value="{!refreshitemlist}" var="reitem">
               if(ticketlist[j].grouptickets[iindex].itemid=="{!reitem.id}")
               {
               ticketlist[j].grouptickets[iindex].availabletickets=Number("{!reitem.Available_Tickets__c}");
               }
               
               </apex:repeat>
           }
           }
           }
           }catch(e){}
           
           
           
           }
           
           function refreshitem()
           {
             refreshitemfunc(eventmand.EventID); 
           }
           
           
       </script>
       <apex:actionPoller interval="5" oncomplete="refreshitem()" reRender="counter"/>
        <apex:actionfunction name="refreshitemfunc" action="{!refreshItem}" reRender="counter" oncomplete="showrefreshitem();">
        <apex:param value="" name="eventid"/>
        </apex:actionfunction>
</apex:form>
<!---- Component & function to Convert to Rich Text ------------------>
    <c:BLN_Tinyeditor ></c:BLN_Tinyeditor>

        <script>
        Richtextconverter_TyniMc('tdesc');
        Richtextconverter_TyniMc('pkdesc');
        </script>
    <!---- #Component & function to Convert to Rich Text ------------------>


<script>

function getCookie(w){
    cName = "";
    pCOOKIES = new Array();
    pCOOKIES = document.cookie.split('; ');
    for(bb = 0; bb < pCOOKIES.length; bb++){
        NmeVal  = new Array();
        NmeVal  = pCOOKIES[bb].split('=');
        if(NmeVal[0] == w){
            cName = unescape(NmeVal[1]);
        }
    }
    return cName;
}

var x = getCookie("oid");
if(x == ''){
window.location.href="{!$Site.BaseUrl}/";
}
</script>

<script>
var x ="{!CASE($User.UserType,'guest','true','false')}";
if(x=='true'){
window.location.href="{!$Site.BaseUrl}/";
}
function updateitemorder(sourceticketlist,destticketlist)
{
var sourceitemids='';
                    var sourceorder=sourceticketlist.trowid;
                    for(var j=0;j<sourceticketlist.ticketcount;j++)
           {
             
          sourceitemids+= sourceticketlist.grouptickets[j].itemid+",";
           }
           if(sourceitemids!='')
           sourceitemids= sourceitemids.slice(0, -1);
           
           var destitemids='';
                    var destorder=destticketlist.trowid;
                    for(var j=0;j<destticketlist.ticketcount;j++)
           {
             
          destitemids+= destticketlist.grouptickets[j].itemid+",";
           }
           if(destitemids!='')
           destitemids= destitemids.slice(0, -1);
             ShowLoader();
                    Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.BLN_ReUse_EventsEditCon.updateorderingitems}',
            sourceitemids,
            sourceticketlist.poolid,
            sourceorder,
            destitemids,
            destticketlist.poolid,
            destorder,
           function(result, event){
         HideLoader();
           }
           );

}


</script>
<script>
function unhideallsession()
{
$('input[name="payradio"][value="Free"]').attr("disabled",false);
     $('input[name="payradio"][value="Paid"]').attr("disabled",false);
     $('input[name="payradio"][value="Donation"]').attr("disabled",false);
      document.getElementById("tvisib").disabled=false;
              document.getElementById("itemtype").disabled=false;
             document.getElementById("tickettype").disabled=false;
             document.getElementById("ticketqty").disabled=false;
             
              var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
       row.cells[3].children[0].disabled=false;
       }
      
}
function hideallsession()
{

$('input[name="payradio"][value="Free"]').attr("disabled",true);
     $('input[name="payradio"][value="Paid"]').attr("disabled",true);
     $('input[name="payradio"][value="Donation"]').attr("disabled",true);
      document.getElementById("tvisib").disabled=true;
              document.getElementById("itemtype").disabled=true;
             document.getElementById("tickettype").disabled=true;
             document.getElementById("ticketqty").disabled=true;
             
              var tmtable = document.getElementById("mytab1");
       for (var p = 1,row; row = tmtable.rows[p]; p++) {
       row.cells[3].children[0].disabled=true;
       }
}
</script>
</apex:page>